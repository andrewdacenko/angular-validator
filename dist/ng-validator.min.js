/**
 * Angular validation helper class
 * @version v0.0.3
 * @link https://github.com/andrewdacenko/ng-validator
 * @license MIT
 */
!function(e,t,r){"use strict";t.module("ngValidator",["ngValidator.message-bag","ngValidator.validation-translator","ngValidator.validator"]),t.module("ngValidator.message-bag",[]).factory("MessageBag",function(){function e(){this.errors={}}return e.prototype.add=function(e,t){this.errors[e]instanceof Array||(this.errors[e]=[]),this.errors[e].push(t)},e.prototype.hasErrors=function(){for(var e in this.errors)if(this.errors.hasOwnProperty(e))return!0;return!1},e.prototype.all=function(){return this.errors},e.prototype.has=function(e){return this.errors[e]?!0:!1},e.prototype.first=function(e){return this.has(e)?this.errors[e][0]:""},e.prototype.get=function(e){return this.has(e)?this.errors[e]:[]},e}),t.module("ngValidator.validation-translator",[]).constant("validationTranslatorLang",{locale:"en",fallback:"en"}).constant("validationTranslatorConfig",{en:{accepted:"The :field must be accepted.",between:{numeric:"The :field must be between :min and :max.",string:"The :field must be between :min and :max characters.",array:"The :field must have between :min and :max items."},max:{numeric:"The :field may not be greater than :max.",string:"The :field may not be greater than :max characters.",array:"The :field may not have more than :max items."},min:{numeric:"The :field must be at least :min.",string:"The :field must be at least :min characters.",array:"The :field must have at least :min items."},not_in:"The selected :field is invalid.",numeric:"The :field must be a number.",regex:"The :field format is invalid.",required:"The :field field is required.",required_if:"The :field field is required when :other is :value.",required_with:"The :field field is required when :values is present.",required_with_all:"The :field field is required when :values is present.",required_without:"The :field field is required when :values is not present.",required_without_all:"The :field field is required when none of :values are present.",custom:{terms:{accepted:"You need to accept Terms & Condition rules."}},fields:{email:"Email address"},values:{colors:{F00:"Red","0F0":"Green","00F":"Blue"}}}}).service("ValidationTranslator",["validationTranslatorLang","validationTranslatorConfig","$parse",function(e,t,r){this.trans=function(e,t,r){return t=t||{},r=r||null,this.get(e,t,r)},this.get=function(e,t,r){for(var i=this.parseLocale(r),a=null,n=0;n<i.length;n++){var a=this.getMessage(i[n],e,t);if(a)break}return a?a:e},this.getMessage=function(e,i){return message=r(e+"."+i)(t),message},this.parseLocale=function(t){return null!==t?[t,this.fallback].filter(function(e){return e}):[e.locale,e.fallback].filter(function(e){return e})}}]),t.module("ngValidator.validator",["ngValidator.message-bag","ngValidator.validation-translator"]).factory("Validator",["MessageBag","ValidationTranslator",function(e,t){function i(e,t,r,i){this.data=e,this.rules=this.explodeRules(t),this.customMessages=r||{},this.customFields=i||{}}function a(e){return(e+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function(e){return e.toUpperCase()})}function n(e){return e=a((e+"").replace(/[-_]/g," ")),e.replace(/[\s]/g,"")}function s(e){return(e+"").replace(/(.)([A-Z])/g,"$1_$2").toLowerCase()}function o(e,t){return e.replace(/:([A-z]*)/g,function(e,r){var i=t[r];return"string"==typeof i||"number"==typeof i?i:e})}return i.make=function(e,t,r,a){return new i(e,t,r,a)},i.prototype.sizeRules=["Size","Between","Min","Max"],i.prototype.numericRules=["Numeric","Integer"],i.prototype.implicitRules=["Required","RequiredWith","RequiredWithAll","RequiredWithout","RequiredWithoutAll","RequiredIf","Accepted"],i.prototype.fallbackMessages={},i.prototype.explodeRules=function(e){for(var t in e)e[t]="string"==typeof e[t]?e[t].split("|"):e[t];return e},i.prototype.parseRule=function(e){return Array.isArray(e)?this.parseArrayRule(e):this.parseStringRule(e)},i.prototype.parseArrayRule=function(e){return{rule:n(e[0].trim()),parameters:e.slice(1)}},i.prototype.parseStringRule=function(e){var t=[];if(-1!==e.indexOf(":")){var r=e.split(":");e=r[0];var t=this.parseParameters(e,r[1])}return{rule:n(e.trim()),parameters:t}},i.prototype.parseParameters=function(e,t){return"regex"==e.toLowerCase()?[t]:t.split(",")},i.prototype.validate=function(e,t){var r=this.parseRule(t);if(""!==r.rule){var i=this.getValue(e);this["validate"+r.rule](e,i,r.parameters)||this.addFailure(e,r.rule,r.parameters)}},i.prototype.passes=function(){this.errors=new e;for(var t in this.rules)for(var r=this.rules[t],i=0;i<r.length;i++)this.validate(t,r[i]);return!this.errors.hasErrors()},i.prototype.fails=function(){return!this.passes()},i.extend=function(e,t,r){e=n(e),i.prototype["validate"+e]=t,i.prototype.defaultMessages[e]=r||""},i.prototype.addFailure=function(e,t,r){var i=this.getMessage(e,t);i=this.doReplacements(i,e,t,r),this.errors.add(e,i)},i.prototype.getMessage=function(e,r){var i=s(r),a=this.getInlineMessage(e,i);if(a)return a;var n=["custom.",e,".",i].join(""),o=t.trans(n);if(o!==n)return o;if(-1!==this.sizeRules.indexOf(r))return this.getSizeMessage(e,r);var u=i,l=t.trans(u);return u!==l?l:this.getInlineMessage(e,i,this.fallbackMessages)||u},i.prototype.getInlineMessage=function(e,t,i){var a=i||this.customMessages,s=[e+"."+t,n(t)];for(var o in s)if(a[s[o]]!==r)return a[s[o]]},i.prototype.getSizeMessage=function(e,r){var i=s(r),a=this.getFieldType(e),n=[i,".",a].join("");return t.trans(n)},i.prototype.doReplacements=function(e,t,i,a){var e=o(e,{field:t});return this["replace"+i]!==r&&(e=this["replace"+i](e,t,i,a)),e},i.prototype.getValue=function(e){return this.data[e]},i.prototype.allRequiredFails=function(e){for(var t=0;t<e.length;t++)if(this.validateRequired(e[t],this.getValue(e[t])))return!1;return!0},i.prototype.validateRequired=function(e,t){if(null===t||t===r)return!1;if("string"==typeof t){if(""===t.trim())return!1}else if(t instanceof Array){if(t.length<1)return!1}else if(t instanceof Object&&!(t instanceof Date)&&0===Object.getOwnPropertyNames(t).length)return!1;return!0},i.prototype.validateRequiredWith=function(e,t,r){return this.allRequiredFails(r)?!0:this.validateRequired(e,t)},i.prototype.validateRequiredIf=function(e,t,r){return this.getValue(r[0])===r[1]?this.validateRequired(e,t):!0},i.prototype.validateAccepted=function(e,t){var r=["yes","on","1",1,!0,"true"];return this.validateRequired(e,t)&&-1!==r.indexOf(t)},i.prototype.validateNumeric=function(e,t){return!isNaN(t)},i.prototype.validateBetween=function(e,t,r){this.requireParameterCount(2,r,"between");var i=this.getSize(e,t);return i>=r[0]&&i<=r[1]},i.prototype.requireParameterCount=function(e,t,r){if(t.length<e)throw new Error("Validation rule "+r+" requires at least "+e+" parameters.")},i.prototype.getSize=function(e,t){var r=this.hasRule(e,this.numericRules);return!isNaN(t)&&r?this.data[e]:Array.isArray(t)?t.length>0:this.getStringSize(t)},i.prototype.getStringSize=function(e){return e?(""+e).trim().length:0},i.prototype.hasRule=function(e,t){return!!this.getRule(e,t)},i.prototype.getRule=function(e,t){if(this.rules[e])for(var r in this.rules){var i=this.parseRule(this.rules[r]);if(-1!==t.indexOf(i.rule))return i}},i.prototype.getField=function(e){if(this.customFields[e])return this.customFields[e];var r="fields."+e,i=t.trans(r);return i!==r?i:s(e).replace(/_/g," ")},i.prototype.getFieldType=function(e){return this.hasRule(e,this.numericRules)?"numeric":this.hasRule(e,"Array")?"array":"string"},i.prototype.getAttributeList=function(e){for(var t=[],r=0;r<e.length;r++)t.push(this.getField(e[r]));return t},i.prototype.getDisplayableValue=function(e,r){if(this.customValues[e][r])return this.customValues[e][r];var i="values."+e+"."+r,a=t.trans(i);return a!==i?a:r},i.prototype.replaceBetween=function(e,t,r,i){return e.replace(":min",i[0]).replace(":max",i[1])},i.prototype.replaceDigits=function(e,t,r,i){return e.replace(":digits",i[0])},i.prototype.replaceDigitsBetween=function(e,t,r,i){return this.replaceBetween(e,t,r,i)},i.prototype.replaceSize=function(e,t,r,i){return e.replace(":size",i[0])},i.prototype.replaceMin=function(e,t,r,i){return e.replace(":min",i[0])},i.prototype.replaceMax=function(e,t,r,i){return e.replace(":max",i[0])},i.prototype.replaceIn=function(e,t,r,i){for(var a=0;a<i.length;a++)i[a]=this.getDisplayableValue(t,i[a]);return e.replace(":values",i.join(", "))},i.prototype.replaceNotIn=function(e,t,r,i){return this.replaceIn(e,t,r,i)},i.prototype.replaceMimes=function(e,t,r,i){return e.replace(":values",i.join(", "))},i.prototype.replaceRequiredWith=function(e,t,r,i){return i=this.getFieldList(i),e.replace(":values",i.join(" / "))},i.prototype.replaceRequiredWithout=function(e,t,r,i){return this.replaceRequiredWith(e,t,r,i)},i.prototype.replaceRequiredWithoutAll=function(e,t,r,i){return this.replaceRequiredWith(e,t,r,i)},i.prototype.replaceRequiredIf=function(e,t,r,i){return i[1]=this.getDisplayableValue(i[0],array_get(this.data,i[0])),i[0]=this.getField(i[0]),e.replace(":other",i[0]).replace(":value",i[1])},i.prototype.replaceSame=function(e,t,r,i){return e.replace(":other",this.getField(i[0]))},i.prototype.replaceDifferent=function(e,t,r,i){return this.replaceSame(e,t,r,i)},i.prototype.replaceDateFormat=function(e,t,r,i){return e.replace(":format",i[0])},i.prototype.replaceBefore=function(e,t,r,i){return Date.parse(i[0])?e.replace(":date",i[0]):e.replace(":date",this.getField(i[0]))},i.prototype.replaceAfter=function(e,t,r,i){return this.replaceBefore(e,t,r,i)},i}])}(window,angular);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lc3NhZ2UtYmFnL21lc3NhZ2UtYmFnLmpzIiwidmFsaWRhdGlvbi10cmFuc2xhdG9yL3ZhbGlkYXRpb24tdHJhbnNsYXRvci5qcyIsInZhbGlkYXRvci92YWxpZGF0b3IuanMiLCJuZy12YWxpZGF0b3IubWluLmpzIl0sIm5hbWVzIjpbIndpbmRvdyIsImFuZ3VsYXIiLCJ1bmRlZmluZWQiLCJtb2R1bGUiLCJmYWN0b3J5IiwiTWVzc2FnZUJhZyIsInRoaXMiLCJlcnJvcnMiLCJwcm90b3R5cGUiLCJhZGQiLCJmaWVsZCIsIm1lc3NhZ2UiLCJBcnJheSIsInB1c2giLCJoYXNFcnJvcnMiLCJwcm9wIiwiaGFzT3duUHJvcGVydHkiLCJhbGwiLCJoYXMiLCJmaXJzdCIsImdldCIsImNvbnN0YW50IiwibG9jYWxlIiwiZmFsbGJhY2siLCJlbiIsImFjY2VwdGVkIiwiYmV0d2VlbiIsIm51bWVyaWMiLCJzdHJpbmciLCJhcnJheSIsIm1heCIsIm1pbiIsIm5vdF9pbiIsInJlZ2V4IiwicmVxdWlyZWQiLCJyZXF1aXJlZF9pZiIsInJlcXVpcmVkX3dpdGgiLCJyZXF1aXJlZF93aXRoX2FsbCIsInJlcXVpcmVkX3dpdGhvdXQiLCJyZXF1aXJlZF93aXRob3V0X2FsbCIsImN1c3RvbSIsInRlcm1zIiwiZmllbGRzIiwiZW1haWwiLCJ2YWx1ZXMiLCJjb2xvcnMiLCJGMDAiLCIwRjAiLCIwMEYiLCJzZXJ2aWNlIiwidmFsaWRhdGlvblRyYW5zbGF0b3JMYW5nIiwidmFsaWRhdGlvblRyYW5zbGF0b3JDb25maWciLCIkcGFyc2UiLCJ0cmFucyIsImtleSIsInBhcmFtZXRlcnMiLCJyZXBsYWNlIiwibG9jYWxlcyIsInBhcnNlTG9jYWxlIiwiaSIsImxlbmd0aCIsImdldE1lc3NhZ2UiLCJmaWx0ZXIiLCJsIiwiVmFsaWRhdGlvblRyYW5zbGF0b3IiLCJWYWxpZGF0b3IiLCJkYXRhIiwicnVsZXMiLCJjdXN0b21NZXNzYWdlcyIsImN1c3RvbUZpZWxkcyIsImV4cGxvZGVSdWxlcyIsInVjd29yZHMiLCJzdHIiLCIkMSIsInRvVXBwZXJDYXNlIiwic3R1ZGx5Q2FzZSIsInNuYWtlQ2FzZSIsInRvTG93ZXJDYXNlIiwiYSIsImIiLCJyIiwibWFrZSIsInNpemVSdWxlcyIsIm51bWVyaWNSdWxlcyIsImltcGxpY2l0UnVsZXMiLCJmYWxsYmFja01lc3NhZ2VzIiwic3BsaXQiLCJwYXJzZVJ1bGUiLCJpc0FycmF5IiwicGFyc2VBcnJheVJ1bGUiLCJwYXJzZVN0cmluZ1J1bGUiLCJydWxlIiwidHJpbSIsInNsaWNlIiwiaW5kZXhPZiIsImxpc3QiLCJwYXJzZVBhcmFtZXRlcnMiLCJwYXJhbWV0ZXIiLCJ2YWxpZGF0ZSIsInBhcnNlZCIsInZhbHVlIiwiZ2V0VmFsdWUiLCJhZGRGYWlsdXJlIiwicGFzc2VzIiwiZmllbGRSdWxlcyIsImZhaWxzIiwiZXh0ZW5kIiwiZm4iLCJkZWZhdWx0TWVzc2FnZXMiLCJkb1JlcGxhY2VtZW50cyIsImxvd2VyUnVsZSIsImlubGluZU1lc3NhZ2UiLCJnZXRJbmxpbmVNZXNzYWdlIiwiY3VzdG9tS2V5Iiwiam9pbiIsImN1c3RvbU1lc3NhZ2UiLCJnZXRTaXplTWVzc2FnZSIsInNvdXJjZSIsIm1lc3NhZ2VzIiwia2V5cyIsInR5cGUiLCJnZXRGaWVsZFR5cGUiLCJhbGxSZXF1aXJlZEZhaWxzIiwidmFsaWRhdGVSZXF1aXJlZCIsIk9iamVjdCIsIkRhdGUiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwidmFsaWRhdGVSZXF1aXJlZFdpdGgiLCJ2YWxpZGF0ZVJlcXVpcmVkSWYiLCJ2YWxpZGF0ZUFjY2VwdGVkIiwiYWNjZXB0YWJsZSIsInZhbGlkYXRlTnVtZXJpYyIsImlzTmFOIiwidmFsaWRhdGVCZXR3ZWVuIiwicmVxdWlyZVBhcmFtZXRlckNvdW50Iiwic2l6ZSIsImdldFNpemUiLCJjb3VudCIsIkVycm9yIiwiaGFzTnVtZXJpYyIsImhhc1J1bGUiLCJnZXRTdHJpbmdTaXplIiwiZ2V0UnVsZSIsImdldEZpZWxkIiwiZ2V0QXR0cmlidXRlTGlzdCIsImdldERpc3BsYXlhYmxlVmFsdWUiLCJjdXN0b21WYWx1ZXMiLCJyZXBsYWNlQmV0d2VlbiIsInJlcGxhY2VEaWdpdHMiLCJyZXBsYWNlRGlnaXRzQmV0d2VlbiIsInJlcGxhY2VTaXplIiwicmVwbGFjZU1pbiIsInJlcGxhY2VNYXgiLCJyZXBsYWNlSW4iLCJyZXBsYWNlTm90SW4iLCJyZXBsYWNlTWltZXMiLCJyZXBsYWNlUmVxdWlyZWRXaXRoIiwiZ2V0RmllbGRMaXN0IiwicmVwbGFjZVJlcXVpcmVkV2l0aG91dCIsInJlcGxhY2VSZXF1aXJlZFdpdGhvdXRBbGwiLCJyZXBsYWNlUmVxdWlyZWRJZiIsImFycmF5X2dldCIsInJlcGxhY2VTYW1lIiwicmVwbGFjZURpZmZlcmVudCIsInJlcGxhY2VEYXRlRm9ybWF0IiwicmVwbGFjZUJlZm9yZSIsInBhcnNlIiwicmVwbGFjZUFmdGVyIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxFQUFBQyxHQUNBLFlBQ0FELEdBQUFFLE9BQUEsZUFBQSwwQkFBQSxvQ0FBQSwwQkFFQUYsRUFDQUUsT0FBQSw4QkFDQUMsUUFBQSxhQUFBLFdBTUEsUUFBQUMsS0FDQUMsS0FBQUMsVUNYQSxNRHNCQUYsR0FBQUcsVUFBQUMsSUFBQSxTQUFBQyxFQUFBQyxHQUNBTCxLQUFBQyxPQUFBRyxZQUFBRSxTQUNBTixLQUFBQyxPQUFBRyxPQUdBSixLQUFBQyxPQUFBRyxHQUFBRyxLQUFBRixJQVFBTixFQUFBRyxVQUFBTSxVQUFBLFdBQ0EsSUFBQSxHQUFBQyxLQUFBVCxNQUFBQyxPQUNBLEdBQUFELEtBQUFDLE9BQUFTLGVBQUFELEdBQ0EsT0FBQSxDQUdBLFFBQUEsR0FRQVYsRUFBQUcsVUFBQVMsSUFBQSxXQUNBLE1BQUFYLE1BQUFDLFFBU0FGLEVBQUFHLFVBQUFVLElBQUEsU0FBQVIsR0FDQSxNQUFBSixNQUFBQyxPQUFBRyxJQUFBLEdBQUEsR0FTQUwsRUFBQUcsVUFBQVcsTUFBQSxTQUFBVCxHQUNBLE1BQUFKLE1BQUFZLElBQUFSLEdBQ0FKLEtBQUFDLE9BQUFHLEdBQUEsR0FHQSxJQVNBTCxFQUFBRyxVQUFBWSxJQUFBLFNBQUFWLEdBQ0EsTUFBQUosTUFBQVksSUFBQVIsR0FDQUosS0FBQUMsT0FBQUcsT0NyRkFMLElBRUFKLEVBQ0FFLE9BQUEsd0NBQ0FrQixTQUFBLDRCQUNBQyxPQUFBLEtBQ0FDLFNBQUEsT0FFQUYsU0FBQSw4QkFDQUcsSUFDQUMsU0FBQSwrQkFDQUMsU0FDQUMsUUFBQSw0Q0FDQUMsT0FBQSx1REFDQUMsTUFBQSxxREFFQUMsS0FDQUgsUUFBQSwyQ0FDQUMsT0FBQSxzREFDQUMsTUFBQSxpREFFQUUsS0FDQUosUUFBQSxvQ0FDQUMsT0FBQSwrQ0FDQUMsTUFBQSw2Q0FFQUcsT0FBQSxrQ0FDQUwsUUFBQSwrQkFDQU0sTUFBQSxnQ0FDQUMsU0FBQSxnQ0FDQUMsWUFBQSxzREFDQUMsY0FBQSx3REFDQUMsa0JBQUEsd0RBQ0FDLGlCQUFBLDREQUNBQyxxQkFBQSxpRUFFQUMsUUFDQUMsT0FDQWhCLFNBQUEsZ0RBSUFpQixRQUNBQyxNQUFBLGlCQUdBQyxRQUdBQyxRQUNBQyxJQUFBLE1BQ0FDLE1BQUEsUUFDQUMsTUFBQSxZQUtBQyxRQUFBLHdCQUFBLDJCQUFBLDZCQUFBLFNBQ0EsU0FBQUMsRUFBQUMsRUFBQUMsR0FTQTlDLEtBQUErQyxNQUFBLFNBQUFDLEVBQUFDLEVBQUFqQyxHQUlBLE1BSEFpQyxHQUFBQSxNQUNBakMsRUFBQUEsR0FBQSxLQUVBaEIsS0FBQWMsSUFBQWtDLEVBQUFDLEVBQUFqQyxJQVdBaEIsS0FBQWMsSUFBQSxTQUFBa0MsRUFBQUUsRUFBQWxDLEdBT0EsSUFBQSxHQUhBbUMsR0FBQW5ELEtBQUFvRCxZQUFBcEMsR0FFQVgsRUFBQSxLQUNBZ0QsRUFBQSxFQUFBQSxFQUFBRixFQUFBRyxPQUFBRCxJQUFBLENBQ0EsR0FBQWhELEdBQUFMLEtBQUF1RCxXQUFBSixFQUFBRSxHQUFBTCxFQUFBRSxFQUVBLElBQUE3QyxFQUFBLE1BT0EsTUFBQUEsR0FDQUEsRUFEQTJDLEdBWUFoRCxLQUFBdUQsV0FBQSxTQUFBdkMsRUFBQWdDLEdBR0EsTUFGQTNDLFNBQUF5QyxFQUFBOUIsRUFBQSxJQUFBZ0MsR0FBQUgsR0FFQXhDLFNBU0FMLEtBQUFvRCxZQUFBLFNBQUFwQyxHQUNBLE1BQUEsUUFBQUEsR0FDQUEsRUFBQWhCLEtBQUFpQixVQUFBdUMsT0FBQSxTQUFBQyxHQUNBLE1BQUFBLE1BSUFiLEVBQUE1QixPQUFBNEIsRUFBQTNCLFVBQUF1QyxPQUFBLFNBQUFDLEdBQ0EsTUFBQUEsU0NqSUE5RCxFQUNBRSxPQUFBLHlCQUFBLDBCQUFBLHNDQUNBQyxRQUFBLGFBQUEsYUFBQSx1QkFDQSxTQUFBQyxFQUFBMkQsR0FVQSxRQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBL0QsS0FBQTRELEtBQUFBLEVBQ0E1RCxLQUFBNkQsTUFBQTdELEtBQUFnRSxhQUFBSCxHQUNBN0QsS0FBQThELGVBQUFBLE1BQ0E5RCxLQUFBK0QsYUFBQUEsTUFtMkJBLFFBQUFFLEdBQUFDLEdBYUEsT0FBQUEsRUFBQSxJQUFBaEIsUUFBQSxpREFBQSxTQUFBaUIsR0FDQSxNQUFBQSxHQUFBQyxnQkFVQSxRQUFBQyxHQUFBSCxHQUVBLE1BREFBLEdBQUFELEdBQUFDLEVBQUEsSUFBQWhCLFFBQUEsUUFBQSxNQUNBZ0IsRUFBQWhCLFFBQUEsUUFBQSxJQVNBLFFBQUFvQixHQUFBSixHQUNBLE9BQUFBLEVBQUEsSUFBQWhCLFFBQUEsY0FBQSxTQUFBcUIsY0FHQSxRQUFBckIsR0FBQWdCLEVBQUFOLEdBQ0EsTUFBQU0sR0FBQWhCLFFBQUEsYUFDQSxTQUFBc0IsRUFBQUMsR0FDQSxHQUFBQyxHQUFBZCxFQUFBYSxFQUNBLE9BQUEsZ0JBQUFDLElBQUEsZ0JBQUFBLEdBQUFBLEVBQUFGLElDc09ZLE1Edm1DWmIsR0FBQWdCLEtBQUEsU0FBQWYsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQSxNQUFBLElBQUFKLEdBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLElBUUFKLEVBQUF6RCxVQUFBMEUsV0FBQSxPQUFBLFVBQUEsTUFBQSxPQU9BakIsRUFBQXpELFVBQUEyRSxjQUFBLFVBQUEsV0FPQWxCLEVBQUF6RCxVQUFBNEUsZUFBQSxXQUFBLGVBQUEsa0JBQUEsa0JBQUEscUJBQUEsYUFBQSxZQU9BbkIsRUFBQXpELFVBQUE2RSxvQkFRQXBCLEVBQUF6RCxVQUFBOEQsYUFBQSxTQUFBSCxHQUNBLElBQUEsR0FBQXpELEtBQUF5RCxHQUNBQSxFQUFBekQsR0FBQSxnQkFBQXlELEdBQUF6RCxHQUFBeUQsRUFBQXpELEdBQUE0RSxNQUFBLEtBQUFuQixFQUFBekQsRUFHQSxPQUFBeUQsSUFTQUYsRUFBQXpELFVBQUErRSxVQUFBLFNBQUFwQixHQUNBLE1BQUF2RCxPQUFBNEUsUUFBQXJCLEdBQ0E3RCxLQUFBbUYsZUFBQXRCLEdBR0E3RCxLQUFBb0YsZ0JBQUF2QixJQVNBRixFQUFBekQsVUFBQWlGLGVBQUEsU0FBQXRCLEdBQ0EsT0FDQXdCLEtBQUFoQixFQUFBUixFQUFBLEdBQUF5QixRQUNBckMsV0FBQVksRUFBQTBCLE1BQUEsS0FVQTVCLEVBQUF6RCxVQUFBa0YsZ0JBQUEsU0FBQXZCLEdBQ0EsR0FBQVosS0FJQSxJQUFBLEtBQUFZLEVBQUEyQixRQUFBLEtBQUEsQ0FDQSxHQUFBQyxHQUFBNUIsRUFBQW1CLE1BQUEsSUFDQW5CLEdBQUE0QixFQUFBLEVBQ0EsSUFBQXhDLEdBQUFqRCxLQUFBMEYsZ0JBQUE3QixFQUFBNEIsRUFBQSxJQUdBLE9BQ0FKLEtBQUFoQixFQUFBUixFQUFBeUIsUUFDQXJDLFdBQUFBLElBV0FVLEVBQUF6RCxVQUFBd0YsZ0JBQUEsU0FBQUwsRUFBQU0sR0FDQSxNQUFBLFNBQUFOLEVBQUFkLGVBQUFvQixHQUNBQSxFQUFBWCxNQUFBLE1BVUFyQixFQUFBekQsVUFBQTBGLFNBQUEsU0FBQXhGLEVBQUFpRixHQUNBLEdBQUFRLEdBQUE3RixLQUFBaUYsVUFBQUksRUFFQSxJQUFBLEtBQUFRLEVBQUFSLEtBQUEsQ0FFQSxHQUFBUyxHQUFBOUYsS0FBQStGLFNBQUEzRixFQUVBSixNQUFBLFdBQUE2RixFQUFBUixNQUFBakYsRUFBQTBGLEVBQUFELEVBQUE1QyxhQUNBakQsS0FBQWdHLFdBQUE1RixFQUFBeUYsRUFBQVIsS0FBQVEsRUFBQTVDLGNBU0FVLEVBQUF6RCxVQUFBK0YsT0FBQSxXQUNBakcsS0FBQUMsT0FBQSxHQUFBRixFQUVBLEtBQUEsR0FBQUssS0FBQUosTUFBQTZELE1BR0EsSUFBQSxHQUZBcUMsR0FBQWxHLEtBQUE2RCxNQUFBekQsR0FFQWlELEVBQUEsRUFBQUEsRUFBQTZDLEVBQUE1QyxPQUFBRCxJQUNBckQsS0FBQTRGLFNBQUF4RixFQUFBOEYsRUFBQTdDLEdBS0EsUUFBQXJELEtBQUFDLE9BQUFPLGFBUUFtRCxFQUFBekQsVUFBQWlHLE1BQUEsV0FDQSxPQUFBbkcsS0FBQWlHLFVBV0F0QyxFQUFBeUMsT0FBQSxTQUFBZixFQUFBZ0IsRUFBQWhHLEdBQ0FnRixFQUFBaEIsRUFBQWdCLEdBQ0ExQixFQUFBekQsVUFBQSxXQUFBbUYsR0FBQWdCLEVBQ0ExQyxFQUFBekQsVUFBQW9HLGdCQUFBakIsR0FBQWhGLEdBQUEsSUFXQXNELEVBQUF6RCxVQUFBOEYsV0FBQSxTQUFBNUYsRUFBQWlGLEVBQUFwQyxHQUNBLEdBQUE1QyxHQUFBTCxLQUFBdUQsV0FBQW5ELEVBQUFpRixFQUVBaEYsR0FBQUwsS0FBQXVHLGVBQUFsRyxFQUFBRCxFQUFBaUYsRUFBQXBDLEdBRUFqRCxLQUFBQyxPQUFBRSxJQUFBQyxFQUFBQyxJQVVBc0QsRUFBQXpELFVBQUFxRCxXQUFBLFNBQUFuRCxFQUFBaUYsR0FDQSxHQUFBbUIsR0FBQWxDLEVBQUFlLEdBRUFvQixFQUFBekcsS0FBQTBHLGlCQUFBdEcsRUFBQW9HLEVBTUEsSUFBQUMsRUFDQSxNQUFBQSxFQUdBLElBQUFFLElBQUEsVUFBQXZHLEVBQUEsSUFBQW9HLEdBQUFJLEtBQUEsSUFFQUMsRUFBQW5ELEVBQUFYLE1BQUE0RCxFQU1BLElBQUFFLElBQUFGLEVBQ0EsTUFBQUUsRUFNQSxJQUFBLEtBQUE3RyxLQUFBNEUsVUFBQVksUUFBQUgsR0FDQSxNQUFBckYsTUFBQThHLGVBQUExRyxFQUFBaUYsRUFNQSxJQUFBckMsR0FBQXdELEVBQ0FWLEVBQUFwQyxFQUFBWCxNQUFBQyxFQUVBLE9BQUFBLEtBQUE4QyxFQUNBQSxFQUdBOUYsS0FBQTBHLGlCQUFBdEcsRUFBQW9HLEVBQUF4RyxLQUFBK0UsbUJBQUEvQixHQVdBVyxFQUFBekQsVUFBQXdHLGlCQUFBLFNBQUF0RyxFQUFBb0csRUFBQU8sR0FDQSxHQUFBQyxHQUFBRCxHQUFBL0csS0FBQThELGVBQ0FtRCxHQUFBN0csRUFBQSxJQUFBb0csRUFBQW5DLEVBQUFtQyxHQU1BLEtBQUEsR0FBQXhELEtBQUFpRSxHQUNBLEdBQUFELEVBQUFDLEVBQUFqRSxNQUFBcEQsRUFBQSxNQUFBb0gsR0FBQUMsRUFBQWpFLEtBV0FXLEVBQUF6RCxVQUFBNEcsZUFBQSxTQUFBMUcsRUFBQWlGLEdBQ0EsR0FBQW1CLEdBQUFsQyxFQUFBZSxHQUtBNkIsRUFBQWxILEtBQUFtSCxhQUFBL0csR0FFQTRDLEdBQUF3RCxFQUFBLElBQUFVLEdBQUFOLEtBQUEsR0FFQSxPQUFBbEQsR0FBQVgsTUFBQUMsSUFZQVcsRUFBQXpELFVBQUFxRyxlQUFBLFNBQUFsRyxFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsR0FBQTVDLEdBQUE2QyxFQUFBN0MsR0FDQUQsTUFBQUEsR0FPQSxPQUpBSixNQUFBLFVBQUFxRixLQUFBekYsSUFDQVMsRUFBQUwsS0FBQSxVQUFBcUYsR0FBQWhGLEVBQUFELEVBQUFpRixFQUFBcEMsSUFHQTVDLEdBU0FzRCxFQUFBekQsVUFBQTZGLFNBQUEsU0FBQTNGLEdBQ0EsTUFBQUosTUFBQTRELEtBQUF4RCxJQVNBdUQsRUFBQXpELFVBQUFrSCxpQkFBQSxTQUFBaEYsR0FDQSxJQUFBLEdBQUFpQixHQUFBLEVBQUFBLEVBQUFqQixFQUFBa0IsT0FBQUQsSUFDQSxHQUFBckQsS0FBQXFILGlCQUFBakYsRUFBQWlCLEdBQUFyRCxLQUFBK0YsU0FBQTNELEVBQUFpQixLQUNBLE9BQUEsQ0FJQSxRQUFBLEdBVUFNLEVBQUF6RCxVQUFBbUgsaUJBQUEsU0FBQWpILEVBQUEwRixHQUNBLEdBQUEsT0FBQUEsR0FBQUEsSUFBQWxHLEVBQ0EsT0FBQSxDQUNBLElBQUEsZ0JBQUFrRyxJQUNBLEdBQUEsS0FBQUEsRUFBQVIsT0FDQSxPQUFBLE1BRUEsSUFBQVEsWUFBQXhGLFFBQ0EsR0FBQXdGLEVBQUF4QyxPQUFBLEVBQ0EsT0FBQSxNQUVBLElBQUF3QyxZQUFBd0IsV0FBQXhCLFlBQUF5QixRQUNBLElBQUFELE9BQUFFLG9CQUFBMUIsR0FBQXhDLE9BQ0EsT0FBQSxDQUlBLFFBQUEsR0FXQUssRUFBQXpELFVBQUF1SCxxQkFBQSxTQUFBckgsRUFBQTBGLEVBQUE3QyxHQUNBLE1BQUFqRCxNQUFBb0gsaUJBQUFuRSxJQUdBLEVBRkFqRCxLQUFBcUgsaUJBQUFqSCxFQUFBMEYsSUFhQW5DLEVBQUF6RCxVQUFBd0gsbUJBQUEsU0FBQXRILEVBQUEwRixFQUFBN0MsR0FDQSxNQUFBakQsTUFBQStGLFNBQUE5QyxFQUFBLE1BQUFBLEVBQUEsR0FDQWpELEtBQUFxSCxpQkFBQWpILEVBQUEwRixJQUdBLEdBWUFuQyxFQUFBekQsVUFBQXlILGlCQUFBLFNBQUF2SCxFQUFBMEYsR0FDQSxHQUFBOEIsSUFBQSxNQUFBLEtBQUEsSUFBQSxHQUFBLEVBQUEsT0FFQSxPQUFBNUgsTUFBQXFILGlCQUFBakgsRUFBQTBGLElBQUEsS0FBQThCLEVBQUFwQyxRQUFBTSxJQVVBbkMsRUFBQXpELFVBQUEySCxnQkFBQSxTQUFBekgsRUFBQTBGLEdBQ0EsT0FBQWdDLE1BQUFoQyxJQVdBbkMsRUFBQXpELFVBQUE2SCxnQkFBQSxTQUFBM0gsRUFBQTBGLEVBQUE3QyxHQUNBakQsS0FBQWdJLHNCQUFBLEVBQUEvRSxFQUFBLFVBRUEsSUFBQWdGLEdBQUFqSSxLQUFBa0ksUUFBQTlILEVBQUEwRixFQUVBLE9BQUFtQyxJQUFBaEYsRUFBQSxJQUFBZ0YsR0FBQWhGLEVBQUEsSUFZQVUsRUFBQXpELFVBQUE4SCxzQkFBQSxTQUFBRyxFQUFBbEYsRUFBQW9DLEdBQ0EsR0FBQXBDLEVBQUFLLE9BQUE2RSxFQUNBLEtBQUEsSUFBQUMsT0FBQSxtQkFBQS9DLEVBQUEsc0JBQUE4QyxFQUFBLGlCQVdBeEUsRUFBQXpELFVBQUFnSSxRQUFBLFNBQUE5SCxFQUFBMEYsR0FDQSxHQUFBdUMsR0FBQXJJLEtBQUFzSSxRQUFBbEksRUFBQUosS0FBQTZFLGFBTUEsUUFBQWlELE1BQUFoQyxJQUFBdUMsRUFDQXJJLEtBQUE0RCxLQUFBeEQsR0FDQUUsTUFBQTRFLFFBQUFZLEdBQ0FBLEVBQUF4QyxPQUFBLEVBR0F0RCxLQUFBdUksY0FBQXpDLElBU0FuQyxFQUFBekQsVUFBQXFJLGNBQUEsU0FBQXpDLEdBQ0EsTUFBQUEsSUFDQSxHQUFBQSxHQUFBUixPQUFBaEMsT0FHQSxHQVVBSyxFQUFBekQsVUFBQW9JLFFBQUEsU0FBQWxJLEVBQUF5RCxHQUNBLFFBQUE3RCxLQUFBd0ksUUFBQXBJLEVBQUF5RCxJQVVBRixFQUFBekQsVUFBQXNJLFFBQUEsU0FBQXBJLEVBQUF5RCxHQUNBLEdBQUE3RCxLQUFBNkQsTUFBQXpELEdBSUEsSUFBQSxHQUFBaUYsS0FBQXJGLE1BQUE2RCxNQUFBLENBQ0EsR0FBQWdDLEdBQUE3RixLQUFBaUYsVUFBQWpGLEtBQUE2RCxNQUFBd0IsR0FFQSxJQUFBLEtBQUF4QixFQUFBMkIsUUFBQUssRUFBQVIsTUFDQSxNQUFBUSxLQVdBbEMsRUFBQXpELFVBQUF1SSxTQUFBLFNBQUFySSxHQUlBLEdBQUFKLEtBQUErRCxhQUFBM0QsR0FDQSxNQUFBSixNQUFBK0QsYUFBQTNELEVBR0EsSUFBQTRDLEdBQUEsVUFBQTVDLEVBS0FDLEVBQUFxRCxFQUFBWCxNQUFBQyxFQUVBLE9BQUEzQyxLQUFBMkMsRUFDQTNDLEVBTUFpRSxFQUFBbEUsR0FBQThDLFFBQUEsS0FBQSxNQVNBUyxFQUFBekQsVUFBQWlILGFBQUEsU0FBQS9HLEdBQ0EsTUFBQUosTUFBQXNJLFFBQUFsSSxFQUFBSixLQUFBNkUsY0FDQSxVQUNBN0UsS0FBQXNJLFFBQUFsSSxFQUFBLFNBQ0EsUUFHQSxVQVNBdUQsRUFBQXpELFVBQUF3SSxpQkFBQSxTQUFBcEcsR0FNQSxJQUFBLEdBTEFGLE1BS0FpQixFQUFBLEVBQUFBLEVBQUFmLEVBQUFnQixPQUFBRCxJQUNBakIsRUFBQTdCLEtBQUFQLEtBQUF5SSxTQUFBbkcsRUFBQWUsSUFHQSxPQUFBakIsSUFVQXVCLEVBQUF6RCxVQUFBeUksb0JBQUEsU0FBQXZJLEVBQUEwRixHQUNBLEdBQUE5RixLQUFBNEksYUFBQXhJLEdBQUEwRixHQUNBLE1BQUE5RixNQUFBNEksYUFBQXhJLEdBQUEwRixFQUdBLElBQUE5QyxHQUFBLFVBQUE1QyxFQUFBLElBQUEwRixFQUVBekYsRUFBQXFELEVBQUFYLE1BQUFDLEVBRUEsT0FBQTNDLEtBQUEyQyxFQUNBM0MsRUFHQXlGLEdBWUFuQyxFQUFBekQsVUFBQTJJLGVBQUEsU0FBQXhJLEVBQUFELEVBQUFpRixFQUFBcEMsR0FDQSxNQUFBNUMsR0FBQTZDLFFBQUEsT0FBQUQsRUFBQSxJQUFBQyxRQUFBLE9BQUFELEVBQUEsS0FZQVUsRUFBQXpELFVBQUE0SSxjQUFBLFNBQUF6SSxFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsTUFBQTVDLEdBQUE2QyxRQUFBLFVBQUFELEVBQUEsS0FZQVUsRUFBQXpELFVBQUE2SSxxQkFBQSxTQUFBMUksRUFBQUQsRUFBQWlGLEVBQUFwQyxHQUNBLE1BQUFqRCxNQUFBNkksZUFBQXhJLEVBQUFELEVBQUFpRixFQUFBcEMsSUFZQVUsRUFBQXpELFVBQUE4SSxZQUFBLFNBQUEzSSxFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsTUFBQTVDLEdBQUE2QyxRQUFBLFFBQUFELEVBQUEsS0FZQVUsRUFBQXpELFVBQUErSSxXQUFBLFNBQUE1SSxFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsTUFBQTVDLEdBQUE2QyxRQUFBLE9BQUFELEVBQUEsS0FZQVUsRUFBQXpELFVBQUFnSixXQUFBLFNBQUE3SSxFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsTUFBQTVDLEdBQUE2QyxRQUFBLE9BQUFELEVBQUEsS0FZQVUsRUFBQXpELFVBQUFpSixVQUFBLFNBQUE5SSxFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsSUFBQSxHQUFBSSxHQUFBLEVBQUFBLEVBQUFKLEVBQUFLLE9BQUFELElBQ0FKLEVBQUFJLEdBQUFyRCxLQUFBMkksb0JBQUF2SSxFQUFBNkMsRUFBQUksR0FHQSxPQUFBaEQsR0FBQTZDLFFBQUEsVUFBQUQsRUFBQTJELEtBQUEsUUFZQWpELEVBQUF6RCxVQUFBa0osYUFBQSxTQUFBL0ksRUFBQUQsRUFBQWlGLEVBQUFwQyxHQUNBLE1BQUFqRCxNQUFBbUosVUFBQTlJLEVBQUFELEVBQUFpRixFQUFBcEMsSUFZQVUsRUFBQXpELFVBQUFtSixhQUFBLFNBQUFoSixFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsTUFBQTVDLEdBQUE2QyxRQUFBLFVBQUFELEVBQUEyRCxLQUFBLFFBWUFqRCxFQUFBekQsVUFBQW9KLG9CQUFBLFNBQUFqSixFQUFBRCxFQUFBaUYsRUFBQXBDLEdBRUEsTUFEQUEsR0FBQWpELEtBQUF1SixhQUFBdEcsR0FDQTVDLEVBQUE2QyxRQUFBLFVBQUFELEVBQUEyRCxLQUFBLFNBWUFqRCxFQUFBekQsVUFBQXNKLHVCQUFBLFNBQUFuSixFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsTUFBQWpELE1BQUFzSixvQkFBQWpKLEVBQUFELEVBQUFpRixFQUFBcEMsSUFZQVUsRUFBQXpELFVBQUF1SiwwQkFBQSxTQUFBcEosRUFBQUQsRUFBQWlGLEVBQUFwQyxHQUNBLE1BQUFqRCxNQUFBc0osb0JBQUFqSixFQUFBRCxFQUFBaUYsRUFBQXBDLElBWUFVLEVBQUF6RCxVQUFBd0osa0JBQUEsU0FBQXJKLEVBQUFELEVBQUFpRixFQUFBcEMsR0FJQSxNQUhBQSxHQUFBLEdBQUFqRCxLQUFBMkksb0JBQUExRixFQUFBLEdBQUEwRyxVQUFBM0osS0FBQTRELEtBQUFYLEVBQUEsS0FDQUEsRUFBQSxHQUFBakQsS0FBQXlJLFNBQUF4RixFQUFBLElBRUE1QyxFQUFBNkMsUUFBQSxTQUFBRCxFQUFBLElBQUFDLFFBQUEsU0FBQUQsRUFBQSxLQVlBVSxFQUFBekQsVUFBQTBKLFlBQUEsU0FBQXZKLEVBQUFELEVBQUFpRixFQUFBcEMsR0FDQSxNQUFBNUMsR0FBQTZDLFFBQUEsU0FBQWxELEtBQUF5SSxTQUFBeEYsRUFBQSxNQVlBVSxFQUFBekQsVUFBQTJKLGlCQUFBLFNBQUF4SixFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsTUFBQWpELE1BQUE0SixZQUFBdkosRUFBQUQsRUFBQWlGLEVBQUFwQyxJQVlBVSxFQUFBekQsVUFBQTRKLGtCQUFBLFNBQUF6SixFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsTUFBQTVDLEdBQUE2QyxRQUFBLFVBQUFELEVBQUEsS0FZQVUsRUFBQXpELFVBQUE2SixjQUFBLFNBQUExSixFQUFBRCxFQUFBaUYsRUFBQXBDLEdBQ0EsTUFBQXNFLE1BQUF5QyxNQUFBL0csRUFBQSxJQUdBNUMsRUFBQTZDLFFBQUEsUUFBQUQsRUFBQSxJQUZBNUMsRUFBQTZDLFFBQUEsUUFBQWxELEtBQUF5SSxTQUFBeEYsRUFBQSxNQWNBVSxFQUFBekQsVUFBQStKLGFBQUEsU0FBQTVKLEVBQUFELEVBQUFpRixFQUFBcEMsR0FDQSxNQUFBakQsTUFBQStKLGNBQUExSixFQUFBRCxFQUFBaUYsRUFBQXBDLElDOFJtQlUsTUFHaEJqRSxPQUFRQyIsImZpbGUiOiJuZy12YWxpZGF0b3IubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhclxuICAgIC5tb2R1bGUoJ25nVmFsaWRhdG9yLm1lc3NhZ2UtYmFnJywgW10pXG4gICAgLmZhY3RvcnkoJ01lc3NhZ2VCYWcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGUgYSBuZXcgTWVzc2FnZUJhZyBpbnN0YW5jZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQHJldHVybiBPYmplY3QgIE1lc3NhZ2VCYWdcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIE1lc3NhZ2VCYWcoKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9ycyA9IHt9O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgbmV3IGVycm9yIG9uIGZpZWxkIHZhbGlkYXRpb24uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBmaWVsZFxuICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgcnVsZVxuICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgbWVzc2FnZVxuICAgICAgICAgKiBAcmV0dXJuIGJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIE1lc3NhZ2VCYWcucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChmaWVsZCwgbWVzc2FnZSkge1xuICAgICAgICAgICAgaWYgKCEodGhpcy5lcnJvcnNbZmllbGRdIGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcnNbZmllbGRdID0gW107XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLmVycm9yc1tmaWVsZF0ucHVzaChtZXNzYWdlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBlcnJvcnMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm4gYm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgTWVzc2FnZUJhZy5wcm90b3R5cGUuaGFzRXJyb3JzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiB0aGlzLmVycm9ycykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVycm9ycy5oYXNPd25Qcm9wZXJ0eShwcm9wKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IGFsbCBtZXNzYWdlcyBhZnRlciB2YWxpZGF0aW9uLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcmV0dXJuIE9iamVjdFxuICAgICAgICAgKi9cbiAgICAgICAgTWVzc2FnZUJhZy5wcm90b3R5cGUuYWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVjayBpZiB0aGVyZSBhcmUgZXJyb3JzIGF0IGZpZWxkIHZhbGlkYXRpb24uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBmaWVsZFxuICAgICAgICAgKiBAcmV0dXJuIE9iamVjdFxuICAgICAgICAgKi9cbiAgICAgICAgTWVzc2FnZUJhZy5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNbZmllbGRdID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgZmlyc3QgZXJyb3Igb24gZmllbGQgdmFsaWRhdGlvbi5cbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGZpZWxkXG4gICAgICAgICAqIEByZXR1cm4gT2JqZWN0XG4gICAgICAgICAqL1xuICAgICAgICBNZXNzYWdlQmFnLnByb3RvdHlwZS5maXJzdCA9IGZ1bmN0aW9uIChmaWVsZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaGFzKGZpZWxkKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVycm9yc1tmaWVsZF1bMF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IGFsbCB0aGUgZmllbGQgdmFsaWRhdGlvbiBlcnJvcnMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBmaWVsZFxuICAgICAgICAgKiBAcmV0dXJuIE9iamVjdFxuICAgICAgICAgKi9cbiAgICAgICAgTWVzc2FnZUJhZy5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5oYXMoZmllbGQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JzW2ZpZWxkXTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gTWVzc2FnZUJhZztcbiAgICB9KTsiLCJhbmd1bGFyXG4gICAgLm1vZHVsZSgnbmdWYWxpZGF0b3IudmFsaWRhdGlvbi10cmFuc2xhdG9yJywgW10pXG4gICAgLmNvbnN0YW50KCd2YWxpZGF0aW9uVHJhbnNsYXRvckxhbmcnLCB7XG4gICAgICAgIGxvY2FsZTogJ2VuJyxcbiAgICAgICAgZmFsbGJhY2s6ICdlbidcbiAgICB9KVxuICAgIC5jb25zdGFudCgndmFsaWRhdGlvblRyYW5zbGF0b3JDb25maWcnLCB7XG4gICAgICAgIFwiZW5cIjoge1xuICAgICAgICAgICAgXCJhY2NlcHRlZFwiOiBcIlRoZSA6ZmllbGQgbXVzdCBiZSBhY2NlcHRlZC5cIixcbiAgICAgICAgICAgIFwiYmV0d2VlblwiOiB7XG4gICAgICAgICAgICAgICAgXCJudW1lcmljXCI6IFwiVGhlIDpmaWVsZCBtdXN0IGJlIGJldHdlZW4gOm1pbiBhbmQgOm1heC5cIixcbiAgICAgICAgICAgICAgICBcInN0cmluZ1wiOiBcIlRoZSA6ZmllbGQgbXVzdCBiZSBiZXR3ZWVuIDptaW4gYW5kIDptYXggY2hhcmFjdGVycy5cIixcbiAgICAgICAgICAgICAgICBcImFycmF5XCI6IFwiVGhlIDpmaWVsZCBtdXN0IGhhdmUgYmV0d2VlbiA6bWluIGFuZCA6bWF4IGl0ZW1zLlwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwibWF4XCI6IHtcbiAgICAgICAgICAgICAgICBcIm51bWVyaWNcIjogXCJUaGUgOmZpZWxkIG1heSBub3QgYmUgZ3JlYXRlciB0aGFuIDptYXguXCIsXG4gICAgICAgICAgICAgICAgXCJzdHJpbmdcIjogXCJUaGUgOmZpZWxkIG1heSBub3QgYmUgZ3JlYXRlciB0aGFuIDptYXggY2hhcmFjdGVycy5cIixcbiAgICAgICAgICAgICAgICBcImFycmF5XCI6IFwiVGhlIDpmaWVsZCBtYXkgbm90IGhhdmUgbW9yZSB0aGFuIDptYXggaXRlbXMuXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJtaW5cIjoge1xuICAgICAgICAgICAgICAgIFwibnVtZXJpY1wiOiBcIlRoZSA6ZmllbGQgbXVzdCBiZSBhdCBsZWFzdCA6bWluLlwiLFxuICAgICAgICAgICAgICAgIFwic3RyaW5nXCI6IFwiVGhlIDpmaWVsZCBtdXN0IGJlIGF0IGxlYXN0IDptaW4gY2hhcmFjdGVycy5cIixcbiAgICAgICAgICAgICAgICBcImFycmF5XCI6IFwiVGhlIDpmaWVsZCBtdXN0IGhhdmUgYXQgbGVhc3QgOm1pbiBpdGVtcy5cIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIm5vdF9pblwiOiBcIlRoZSBzZWxlY3RlZCA6ZmllbGQgaXMgaW52YWxpZC5cIixcbiAgICAgICAgICAgIFwibnVtZXJpY1wiOiBcIlRoZSA6ZmllbGQgbXVzdCBiZSBhIG51bWJlci5cIixcbiAgICAgICAgICAgIFwicmVnZXhcIjogXCJUaGUgOmZpZWxkIGZvcm1hdCBpcyBpbnZhbGlkLlwiLFxuICAgICAgICAgICAgXCJyZXF1aXJlZFwiOiBcIlRoZSA6ZmllbGQgZmllbGQgaXMgcmVxdWlyZWQuXCIsXG4gICAgICAgICAgICBcInJlcXVpcmVkX2lmXCI6IFwiVGhlIDpmaWVsZCBmaWVsZCBpcyByZXF1aXJlZCB3aGVuIDpvdGhlciBpcyA6dmFsdWUuXCIsXG4gICAgICAgICAgICBcInJlcXVpcmVkX3dpdGhcIjogXCJUaGUgOmZpZWxkIGZpZWxkIGlzIHJlcXVpcmVkIHdoZW4gOnZhbHVlcyBpcyBwcmVzZW50LlwiLFxuICAgICAgICAgICAgXCJyZXF1aXJlZF93aXRoX2FsbFwiOiBcIlRoZSA6ZmllbGQgZmllbGQgaXMgcmVxdWlyZWQgd2hlbiA6dmFsdWVzIGlzIHByZXNlbnQuXCIsXG4gICAgICAgICAgICBcInJlcXVpcmVkX3dpdGhvdXRcIjogXCJUaGUgOmZpZWxkIGZpZWxkIGlzIHJlcXVpcmVkIHdoZW4gOnZhbHVlcyBpcyBub3QgcHJlc2VudC5cIixcbiAgICAgICAgICAgIFwicmVxdWlyZWRfd2l0aG91dF9hbGxcIjogXCJUaGUgOmZpZWxkIGZpZWxkIGlzIHJlcXVpcmVkIHdoZW4gbm9uZSBvZiA6dmFsdWVzIGFyZSBwcmVzZW50LlwiLFxuXG4gICAgICAgICAgICBcImN1c3RvbVwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0ZXJtc1wiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiYWNjZXB0ZWRcIjogXCJZb3UgbmVlZCB0byBhY2NlcHQgVGVybXMgJiBDb25kaXRpb24gcnVsZXMuXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIFwiZmllbGRzXCI6IHtcbiAgICAgICAgICAgICAgICBcImVtYWlsXCI6IFwiRW1haWwgYWRkcmVzc1wiLFxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgXCJ2YWx1ZXNcIjoge1xuICAgICAgICAgICAgICAgIC8vIEFzIGFuIGV4YW1wbGUganVzdCBzZXQgZGlzcGxheWFibGUgdmFsdWUgZm9yIGNvbG9ycyBmaWVsZFxuICAgICAgICAgICAgICAgIC8vIGFuZCBpdHMgdmFsdWVzXG4gICAgICAgICAgICAgICAgXCJjb2xvcnNcIjoge1xuICAgICAgICAgICAgICAgICAgICBcIkYwMFwiOiBcIlJlZFwiLFxuICAgICAgICAgICAgICAgICAgICBcIjBGMFwiOiBcIkdyZWVuXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiMDBGXCI6IFwiQmx1ZVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgfSlcbiAgICAuc2VydmljZSgnVmFsaWRhdGlvblRyYW5zbGF0b3InLCBbJ3ZhbGlkYXRpb25UcmFuc2xhdG9yTGFuZycsICd2YWxpZGF0aW9uVHJhbnNsYXRvckNvbmZpZycsICckcGFyc2UnLFxuICAgICAgICBmdW5jdGlvbiBWYWxpZGF0aW9uVHJhbnNsYXRvcih2YWxpZGF0aW9uVHJhbnNsYXRvckxhbmcsIHZhbGlkYXRpb25UcmFuc2xhdG9yQ29uZmlnLCAkcGFyc2UpIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogR2V0IHRoZSB0cmFuc2xhdGlvbiBmb3IgYSBnaXZlbiBrZXkuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGtleVxuICAgICAgICAgICAgICogQHBhcmFtICBPYmplY3QgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBsb2NhbGVcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMudHJhbnMgPSBmdW5jdGlvbiB0cmFucyhrZXksIHBhcmFtZXRlcnMsIGxvY2FsZSkge1xuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzIHx8IHt9O1xuICAgICAgICAgICAgICAgIGxvY2FsZSA9IGxvY2FsZSB8fCBudWxsO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KGtleSwgcGFyYW1ldGVycywgbG9jYWxlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogR2V0IHRoZSB0cmFuc2xhdGlvbiBmb3IgdGhlIGdpdmVuIGtleS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAga2V5XG4gICAgICAgICAgICAgKiBAcGFyYW0gIE9iamVjdCAgcmVwbGFjZVxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGxvY2FsZVxuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5nZXQgPSBmdW5jdGlvbiBnZXQoa2V5LCByZXBsYWNlLCBsb2NhbGUpIHtcbiAgICAgICAgICAgICAgICAvLyBIZXJlIHdlIHdpbGwgZ2V0IHRoZSBsb2NhbGUgdGhhdCBzaG91bGQgYmUgdXNlZCBmb3IgdGhlXG4gICAgICAgICAgICAgICAgLy8gbGFuZ3VhZ2UuIElmIG9uZSB3YXMgbm90IHBhc3NlZCwgd2Ugd2lsbCB1c2UgdGhlIGRlZmF1bHRcbiAgICAgICAgICAgICAgICAvLyBsb2NhbGUuIFRoZW4sIHdlIGNhbiBnZXQgdGhlICBtZXNzYWdlIGFuZCByZXR1cm4uXG4gICAgICAgICAgICAgICAgdmFyIGxvY2FsZXMgPSB0aGlzLnBhcnNlTG9jYWxlKGxvY2FsZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb2NhbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gdGhpcy5nZXRNZXNzYWdlKGxvY2FsZXNbaV0sIGtleSwgcmVwbGFjZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UpIGJyZWFrO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbWVzc2FnZSBkb2Vzbid0IGV4aXN0LCB3ZSB3aWxsIHJldHVybiBiYWNrIHRoZSBrZXlcbiAgICAgICAgICAgICAgICAvLyB3aGljaCB3YXMgcmVxdWVzdGVkIGFzIHRoYXQgd2lsbCBiZSBxdWljayB0byBzcG90IGluIHRoZSBVSVxuICAgICAgICAgICAgICAgIC8vIGlmIGxhbmd1YWdlIGtleXMgYXJlIHdyb25nIG9yIG1pc3NpbmcgZnJvbSB0aGUgdHJhbnNsYXRvcidzXG4gICAgICAgICAgICAgICAgLy8gbGFuZ3VhZ2UgY29uZmlnLiBPdGhlcndpc2Ugd2UgY2FuIHJldHVybiB0aGUgbWVzc2FnZS5cbiAgICAgICAgICAgICAgICBpZiAoIW1lc3NhZ2UpIHJldHVybiBrZXk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFJldHJpZXZlIGEgbGFuZ3VhZ2UgbGluZSBvdXQgdGhlIGxvYWRlZCBPYmplY3QuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGxvY2FsZVxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGtleVxuICAgICAgICAgICAgICogQHBhcmFtICBPYmplY3QgIHJlcGxhY2VcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nfHVuZGVmaW5lZFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmdldE1lc3NhZ2UgPSBmdW5jdGlvbiBnZXRNZXNzYWdlKGxvY2FsZSwga2V5LCByZXBsYWNlKSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9ICRwYXJzZShsb2NhbGUgKyAnLicgKyBrZXkpKHZhbGlkYXRpb25UcmFuc2xhdG9yQ29uZmlnKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBHZXQgdGhlIGFycmF5IG9mIGxvY2FsZXMgdG8gYmUgY2hlY2tlZC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZ3xudWxsICBsb2NhbGVcbiAgICAgICAgICAgICAqIEByZXR1cm4gQXJyYXlcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5wYXJzZUxvY2FsZSA9IGZ1bmN0aW9uIHBhcnNlTG9jYWxlKGxvY2FsZSkge1xuICAgICAgICAgICAgICAgIGlmIChsb2NhbGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtsb2NhbGUsIHRoaXMuZmFsbGJhY2tdLmZpbHRlcihmdW5jdGlvbiAobCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGw7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gW3ZhbGlkYXRpb25UcmFuc2xhdG9yTGFuZy5sb2NhbGUsIHZhbGlkYXRpb25UcmFuc2xhdG9yTGFuZy5mYWxsYmFja10uZmlsdGVyKGZ1bmN0aW9uIChsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIF0pOyIsImFuZ3VsYXJcbiAgICAubW9kdWxlKCduZ1ZhbGlkYXRvci52YWxpZGF0b3InLCBbJ25nVmFsaWRhdG9yLm1lc3NhZ2UtYmFnJywgJ25nVmFsaWRhdG9yLnZhbGlkYXRpb24tdHJhbnNsYXRvciddKVxuICAgIC5mYWN0b3J5KCdWYWxpZGF0b3InLCBbJ01lc3NhZ2VCYWcnLCAnVmFsaWRhdGlvblRyYW5zbGF0b3InLFxuICAgICAgICBmdW5jdGlvbiAoTWVzc2FnZUJhZywgVmFsaWRhdGlvblRyYW5zbGF0b3IpIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQ3JlYXRlIGEgbmV3IFZhbGlkYXRvciBpbnN0YW5jZSB3aXRoIGBuZXcgVmFsaWRhdG9yKC4uLmFyZ3MpYC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSAgICAgICAgICAgRGF0YSB0byBiZSB2YWxpZGF0ZWRcbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBydWxlcyAgICAgICAgICBTZXQgb2YgcnVsZXNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjdXN0b21NZXNzYWdlcyBDdXN0b20gbWVzc2FnZXNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjdXN0b21GaWVsZHMgICBDdXN0b20gbWVzc2FnZXNcbiAgICAgICAgICAgICAqIEByZXR1cm4ge1ZhbGlkYXRvcn0gICAgICAgICAgICBWYWxpZGF0b3JcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZnVuY3Rpb24gVmFsaWRhdG9yKGRhdGEsIHJ1bGVzLCBjdXN0b21NZXNzYWdlcywgY3VzdG9tRmllbGRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICAgICB0aGlzLnJ1bGVzID0gdGhpcy5leHBsb2RlUnVsZXMocnVsZXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3VzdG9tTWVzc2FnZXMgPSBjdXN0b21NZXNzYWdlcyB8fCB7fTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1c3RvbUZpZWxkcyA9IGN1c3RvbUZpZWxkcyB8fCB7fTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogT3IgY3JlYXRlIG5ldyB2YWxpZGF0b3IgaW5zdGFuY2UgYnkgY2FsbGluZ1xuICAgICAgICAgICAgICogVmFsaWRhdG9yLm1ha2UoLi4uYXJncykuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgICAgICAgICAgIERhdGEgdG8gYmUgdmFsaWRhdGVkXG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcnVsZXMgICAgICAgICAgU2V0IG9mIHJ1bGVzXG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY3VzdG9tTWVzc2FnZXMgQ3VzdG9tIG1lc3NhZ2VzXG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY3VzdG9tRmllbGRzICAgQ3VzdG9tIG1lc3NhZ2VzXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHtWYWxpZGF0b3J9ICAgICAgICAgICAgVmFsaWRhdG9yXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5tYWtlID0gZnVuY3Rpb24gKGRhdGEsIHJ1bGVzLCBjdXN0b21NZXNzYWdlcywgY3VzdG9tRmllbGRzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBWYWxpZGF0b3IoZGF0YSwgcnVsZXMsIGN1c3RvbU1lc3NhZ2VzLCBjdXN0b21GaWVsZHMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUaGUgc2l6ZSByZWxhdGVkIHZhbGlkYXRpb24gcnVsZXMuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQGZpZWxkIHtBcnJheX1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5zaXplUnVsZXMgPSBbJ1NpemUnLCAnQmV0d2VlbicsICdNaW4nLCAnTWF4J107XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVGhlIG51bWVyaWMgcmVsYXRlZCB2YWxpZGF0aW9uIHJ1bGVzLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBmaWVsZCB7QXJyYXl9XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUubnVtZXJpY1J1bGVzID0gWydOdW1lcmljJywgJ0ludGVnZXInXTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUaGUgdmFsaWRhdGlvbiBydWxlcyB0aGF0IGltcGx5IHRoZSBmaWVsZCBpcyByZXF1aXJlZC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAZmllbGQge0FycmF5fVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmltcGxpY2l0UnVsZXMgPSBbJ1JlcXVpcmVkJywgJ1JlcXVpcmVkV2l0aCcsICdSZXF1aXJlZFdpdGhBbGwnLCAnUmVxdWlyZWRXaXRob3V0JywgJ1JlcXVpcmVkV2l0aG91dEFsbCcsICdSZXF1aXJlZElmJywgJ0FjY2VwdGVkJ107XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRmFsbGJhY2sgbWVzc2FnZXNcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAZmllbGQge09iamVjdH1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5mYWxsYmFja01lc3NhZ2VzID0ge307XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRXhwbG9kZSB0aGUgcnVsZXMgaW50byBhbiBhcnJheSBvZiBydWxlcy5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHtPYmplY3R9ICBydWxlc1xuICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmV4cGxvZGVSdWxlcyA9IGZ1bmN0aW9uIChydWxlcykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGZpZWxkIGluIHJ1bGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bGVzW2ZpZWxkXSA9ICh0eXBlb2YgcnVsZXNbZmllbGRdID09PSAnc3RyaW5nJykgPyBydWxlc1tmaWVsZF0uc3BsaXQoJ3wnKSA6IHJ1bGVzW2ZpZWxkXTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ1bGVzO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBFeHRyYWN0IHRoZSBydWxlIG5hbWUgYW5kIHBhcmFtZXRlcnMgZnJvbSBhIHJ1bGUuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICB7QXJyYXl8U3RyaW5nfSAgcnVsZXNcbiAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5wYXJzZVJ1bGUgPSBmdW5jdGlvbiAocnVsZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShydWxlcykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VBcnJheVJ1bGUocnVsZXMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVN0cmluZ1J1bGUocnVsZXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBQYXJzZSBhbiBhcnJheSBiYXNlZCBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAge0FycmF5fSAgcnVsZXNcbiAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5wYXJzZUFycmF5UnVsZSA9IGZ1bmN0aW9uIChydWxlcykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bGU6IHN0dWRseUNhc2UocnVsZXNbMF0udHJpbSgpKSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyczogcnVsZXMuc2xpY2UoMSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBQYXJzZSBhIHN0cmluZyBiYXNlZCBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBydWxlc1xuICAgICAgICAgICAgICogQHJldHVybiBhcnJheVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnBhcnNlU3RyaW5nUnVsZSA9IGZ1bmN0aW9uIChydWxlcykge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJzID0gW107XG5cbiAgICAgICAgICAgICAgICAvLyBUaGUgZm9ybWF0IGZvciBzcGVjaWZ5aW5nIHZhbGlkYXRpb24gcnVsZXMgYW5kIHBhcmFtZXRlcnMgZm9sbG93cyBhblxuICAgICAgICAgICAgICAgIC8vIGVhc3kge3J1bGV9OntwYXJhbWV0ZXJzfSBmb3JtYXR0aW5nIGNvbnZlbnRpb24uIEZvciBpbnN0YW5jZSB0aGVcbiAgICAgICAgICAgICAgICBpZiAocnVsZXMuaW5kZXhPZignOicpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdCA9IHJ1bGVzLnNwbGl0KCc6Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJ1bGVzID0gbGlzdFswXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtZXRlcnMgPSB0aGlzLnBhcnNlUGFyYW1ldGVycyhydWxlcywgbGlzdFsxXSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcnVsZTogc3R1ZGx5Q2FzZShydWxlcy50cmltKCkpLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiBwYXJhbWV0ZXJzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUGFyc2UgYSBwYXJhbWV0ZXIgbGlzdC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgIHJ1bGVcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICAgcGFyYW1ldGVyXG4gICAgICAgICAgICAgKiBAcmV0dXJuIGFycmF5XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucGFyc2VQYXJhbWV0ZXJzID0gZnVuY3Rpb24gKHJ1bGUsIHBhcmFtZXRlcikge1xuICAgICAgICAgICAgICAgIGlmIChydWxlLnRvTG93ZXJDYXNlKCkgPT0gJ3JlZ2V4JykgcmV0dXJuIFtwYXJhbWV0ZXJdO1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJhbWV0ZXIuc3BsaXQoJywnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBWYWxpZGF0ZSBhIGdpdmVuIGZpZWxkIGFnYWluc3QgYSBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICAgcnVsZVxuICAgICAgICAgICAgICogQHJldHVybiB2b2lkXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiAoZmllbGQsIHJ1bGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyc2VkID0gdGhpcy5wYXJzZVJ1bGUocnVsZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAocGFyc2VkLnJ1bGUgPT09ICcnKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmdldFZhbHVlKGZpZWxkKTtcblxuICAgICAgICAgICAgICAgIGlmICghdGhpc1sndmFsaWRhdGUnICsgcGFyc2VkLnJ1bGVdKGZpZWxkLCB2YWx1ZSwgcGFyc2VkLnBhcmFtZXRlcnMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRmFpbHVyZShmaWVsZCwgcGFyc2VkLnJ1bGUsIHBhcnNlZC5wYXJhbWV0ZXJzKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGRhdGEgcGFzc2VzIHRoZSB2YWxpZGF0aW9uIHJ1bGVzLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEByZXR1cm4gYm9vbGVhblxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnBhc3NlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9ycyA9IG5ldyBNZXNzYWdlQmFnO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZmllbGQgaW4gdGhpcy5ydWxlcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGRSdWxlcyA9IHRoaXMucnVsZXNbZmllbGRdO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRSdWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWxpZGF0ZShmaWVsZCwgZmllbGRSdWxlc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuZXJyb3JzLmhhc0Vycm9ycygpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGRhdGEgZmFpbHMgdGhlIHZhbGlkYXRpb24gcnVsZXMuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHJldHVybiBib29sZWFuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuZmFpbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLnBhc3NlcygpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZWdpc3RlciBhIGN1c3RvbSB2YWxpZGF0b3IgcnVsZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIEZ1bmN0aW9uICBmblxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICAgbWVzc2FnZVxuICAgICAgICAgICAgICogQHJldHVybiB2b2lkXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5leHRlbmQgPSBmdW5jdGlvbiAocnVsZSwgZm4sIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBydWxlID0gc3R1ZGx5Q2FzZShydWxlKTtcbiAgICAgICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlWyd2YWxpZGF0ZScgKyBydWxlXSA9IGZuO1xuICAgICAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuZGVmYXVsdE1lc3NhZ2VzW3J1bGVdID0gbWVzc2FnZSB8fCAnJztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQWRkIGEgZmFpbGVkIHJ1bGUgYW5kIGVycm9yIG1lc3NhZ2UgdG8gdGhlIGNvbGxlY3Rpb24uXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIEFycmF5ICAgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmFkZEZhaWx1cmUgPSBmdW5jdGlvbiAoZmllbGQsIHJ1bGUsIHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHRoaXMuZ2V0TWVzc2FnZShmaWVsZCwgcnVsZSk7XG5cbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gdGhpcy5kb1JlcGxhY2VtZW50cyhtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmVycm9ycy5hZGQoZmllbGQsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBHZXQgdGhlIHZhbGlkYXRpb24gbWVzc2FnZSBmb3IgYSBmaWVsZCBhbmQgcnVsZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgIHJ1bGVcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuZ2V0TWVzc2FnZSA9IGZ1bmN0aW9uIChmaWVsZCwgcnVsZSkge1xuICAgICAgICAgICAgICAgIHZhciBsb3dlclJ1bGUgPSBzbmFrZUNhc2UocnVsZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgaW5saW5lTWVzc2FnZSA9IHRoaXMuZ2V0SW5saW5lTWVzc2FnZShmaWVsZCwgbG93ZXJSdWxlKTtcblxuICAgICAgICAgICAgICAgIC8vIEZpcnN0IHdlIHdpbGwgcmV0cmlldmUgdGhlIGN1c3RvbSBtZXNzYWdlIGZvciB0aGVcbiAgICAgICAgICAgICAgICAvLyB2YWxpZGF0aW9uIHJ1bGUgaWYgb25lIGV4aXN0cy4gSWYgYSBjdXN0b20gdmFsaWRhdGlvblxuICAgICAgICAgICAgICAgIC8vIG1lc3NhZ2UgaXMgYmVpbmcgdXNlZCB3ZSdsbCByZXR1cm4gdGhlIGN1c3RvbSBtZXNzYWdlLFxuICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3ZSdsbCBrZWVwIHNlYXJjaGluZyBmb3IgYSB2YWxpZCBtZXNzYWdlLlxuICAgICAgICAgICAgICAgIGlmIChpbmxpbmVNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmxpbmVNZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgY3VzdG9tS2V5ID0gW1wiY3VzdG9tLlwiLCBmaWVsZCwgJy4nLCBsb3dlclJ1bGVdLmpvaW4oJycpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGN1c3RvbU1lc3NhZ2UgPSBWYWxpZGF0aW9uVHJhbnNsYXRvci50cmFucyhjdXN0b21LZXkpO1xuXG4gICAgICAgICAgICAgICAgLy8gVGhhbiB3ZSBjaGVjayBmb3IgYSBjdXN0b20gZGVmaW5lZCB2YWxpZGF0aW9uIG1lc3NhZ2UgZm9yXG4gICAgICAgICAgICAgICAgLy8gdGhlIGZpZWxkIGFuZCBydWxlLiBUaGlzIGFsbG93cyB0aGUgZGV2ZWxvcGVyIHRvIHNwZWNpZnlcbiAgICAgICAgICAgICAgICAvLyBzcGVjaWZpYyBtZXNzYWdlcyBmb3Igb25seSBzb21lIGZpZWxkcyBhbmQgcnVsZXMgdGhhdCBuZWVkXG4gICAgICAgICAgICAgICAgLy8gdG8gZ2V0IHNwZWNpYWxseSBmb3JtZWQuXG4gICAgICAgICAgICAgICAgaWYgKGN1c3RvbU1lc3NhZ2UgIT09IGN1c3RvbUtleSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VzdG9tTWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcnVsZSBiZWluZyB2YWxpZGF0ZWQgaXMgYSBcInNpemVcIiBydWxlLCB3ZSB3aWxsIG5lZWQgdG8gZ2F0aGVyIHRoZVxuICAgICAgICAgICAgICAgIC8vIHNwZWNpZmljIGVycm9yIG1lc3NhZ2UgZm9yIHRoZSB0eXBlIG9mIGZpZWxkIGJlaW5nIHZhbGlkYXRlZCBzdWNoXG4gICAgICAgICAgICAgICAgLy8gYXMgYSBudW1iZXIsIGZpbGUgb3Igc3RyaW5nIHdoaWNoIGFsbCBoYXZlIGRpZmZlcmVudCBtZXNzYWdlIHR5cGVzLlxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc2l6ZVJ1bGVzLmluZGV4T2YocnVsZSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFNpemVNZXNzYWdlKGZpZWxkLCBydWxlKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8gVGhhbiwgaWYgbm8gZGV2ZWxvcGVyIHNwZWNpZmllZCBtZXNzYWdlcyBoYXZlIGJlZW4gc2V0LCBhbmRcbiAgICAgICAgICAgICAgICAvLyBubyBvdGhlciBzcGVjaWFsIG1lc3NhZ2VzIGFwcGx5IGZvciB0aGlzIHJ1bGUsIHdlIHdpbGwganVzdFxuICAgICAgICAgICAgICAgIC8vIHB1bGwgdGhlIGRlZmF1bHRcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gbG93ZXJSdWxlO1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IFZhbGlkYXRpb25UcmFuc2xhdG9yLnRyYW5zKGtleSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoa2V5ICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldElubGluZU1lc3NhZ2UoZmllbGQsIGxvd2VyUnVsZSwgdGhpcy5mYWxsYmFja01lc3NhZ2VzKSB8fCBrZXk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEdldCB0aGUgaW5tZXNzYWdlIG1lc3NhZ2UgZm9yIGEgcnVsZSBpZiBpdCBleGlzdHMuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICBsb3dlclJ1bGVcbiAgICAgICAgICAgICAqIEBwYXJhbSAgYXJyYXkgICAgc291cmNlXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHN0cmluZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmdldElubGluZU1lc3NhZ2UgPSBmdW5jdGlvbiAoZmllbGQsIGxvd2VyUnVsZSwgc291cmNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VzID0gc291cmNlIHx8IHRoaXMuY3VzdG9tTWVzc2FnZXM7XG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBbZmllbGQgKyAnLicgKyBsb3dlclJ1bGUsIHN0dWRseUNhc2UobG93ZXJSdWxlKV07XG5cbiAgICAgICAgICAgICAgICAvLyBGaXJzdCB3ZSB3aWxsIGNoZWNrIGZvciBhIGN1c3RvbSBtZXNzYWdlIGZvciBhbiBmaWVsZFxuICAgICAgICAgICAgICAgIC8vIHNwZWNpZmljIHJ1bGUgbWVzc2FnZSBmb3IgdGhlIGZpZWxkcywgdGhlbiB3ZSB3aWxsIGNoZWNrXG4gICAgICAgICAgICAgICAgLy8gZm9yIGEgZ2VuZXJhbCBjdXN0b20gbWVzc2FnZSB0aGF0IGlzIG5vdCBmaWVsZCBzcGVjaWZpYy4gSWZcbiAgICAgICAgICAgICAgICAvLyB3ZSBmaW5kIGVpdGhlciB3ZSdsbCByZXR1cm4gaXQuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGtleXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VzW2tleXNba2V5XV0gIT09IHVuZGVmaW5lZCkgcmV0dXJuIG1lc3NhZ2VzW2tleXNba2V5XV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBHZXQgdGhlIHByb3BlciBlcnJvciBtZXNzYWdlIGZvciBhbiBmaWVsZCBhbmQgc2l6ZSBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIHJ1bGVcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuZ2V0U2l6ZU1lc3NhZ2UgPSBmdW5jdGlvbiAoZmllbGQsIHJ1bGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbG93ZXJSdWxlID0gc25ha2VDYXNlKHJ1bGUpO1xuICAgICAgICAgICAgICAgIC8vIFRoZXJlIGFyZSB0aHJlZSBkaWZmZXJlbnQgdHlwZXMgb2Ygc2l6ZSB2YWxpZGF0aW9ucy4gVGhlXG4gICAgICAgICAgICAgICAgLy8gZmllbGQgbWF5IGJlIGVpdGhlciBhIG51bWJlciwgZmlsZSwgb3Igc3RyaW5nIHNvIHdlIHdpbGxcbiAgICAgICAgICAgICAgICAvLyBjaGVjayBhIGZldyB0aGluZ3MgdG8ga25vdyB3aGljaCB0eXBlIG9mIHZhbHVlIGl0IGlzIGFuZFxuICAgICAgICAgICAgICAgIC8vIHJldHVybiB0aGUgY29ycmVjdCBsaW5lIGZvciB0aGF0IHR5cGUuXG4gICAgICAgICAgICAgICAgdmFyIHR5cGUgPSB0aGlzLmdldEZpZWxkVHlwZShmaWVsZCk7XG5cbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gW2xvd2VyUnVsZSwgJy4nLCB0eXBlXS5qb2luKCcnKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBWYWxpZGF0aW9uVHJhbnNsYXRvci50cmFucyhrZXkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBlcnJvciBtZXNzYWdlIHBsYWNlLWhvbGRlcnMgd2l0aCBhY3R1YWwgdmFsdWVzLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBtZXNzYWdlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIGFycmF5ICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5kb1JlcGxhY2VtZW50cyA9IGZ1bmN0aW9uIChtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gcmVwbGFjZShtZXNzYWdlLCB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXNbJ3JlcGxhY2UnICsgcnVsZV0gIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSB0aGlzWydyZXBsYWNlJyArIHJ1bGVdKG1lc3NhZ2UsIGZpZWxkLCBydWxlLCBwYXJhbWV0ZXJzKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEdldCB0aGUgdmFsdWUgb2YgYSBnaXZlbiBmaWVsZC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcmV0dXJuIG1peGVkXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoZmllbGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhW2ZpZWxkXTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRGV0ZXJtaW5lIGlmIGFsbCBvZiB0aGUgZ2l2ZW4gZmllbGRzIGZhaWwgdGhlIHJlcXVpcmVkIHRlc3QuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBBcnJheSAgICBmaWVsZHNcbiAgICAgICAgICAgICAqIEByZXR1cm4gYm9vbGVhblxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmFsbFJlcXVpcmVkRmFpbHMgPSBmdW5jdGlvbiAoZmllbGRzKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudmFsaWRhdGVSZXF1aXJlZChmaWVsZHNbaV0sIHRoaXMuZ2V0VmFsdWUoZmllbGRzW2ldKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFZhbGlkYXRlIHRoYXQgYSByZXF1aXJlZCBmaWVsZCBleGlzdHMuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBtaXhlZCAgICB2YWx1ZVxuICAgICAgICAgICAgICogQHJldHVybiBib29sZWFuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUudmFsaWRhdGVSZXF1aXJlZCA9IGZ1bmN0aW9uIChmaWVsZCwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBPYmplY3QgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh2YWx1ZSkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBWYWxpZGF0ZSB0aGF0IGFuIGZpZWxkIGV4aXN0cyB3aGVuIGFueSBvdGhlciBmaWVsZCBleGlzdHMuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBtaXhlZCAgICB2YWx1ZVxuICAgICAgICAgICAgICogQHBhcmFtICBBcnJheSAgICBwYXJhbWV0ZXJzXG4gICAgICAgICAgICAgKiBAcmV0dXJuIGJvb2xlYW5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS52YWxpZGF0ZVJlcXVpcmVkV2l0aCA9IGZ1bmN0aW9uIChmaWVsZCwgdmFsdWUsIHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuYWxsUmVxdWlyZWRGYWlscyhwYXJhbWV0ZXJzKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZVJlcXVpcmVkKGZpZWxkLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBWYWxpZGF0ZSB0aGF0IGFuIGZpZWxkIGV4aXN0cyB3aGVuIG90aGVyIGZpZWxkIGhhcyBjZXJ0YWluIHZhbHVlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgbWl4ZWQgICAgdmFsdWVcbiAgICAgICAgICAgICAqIEBwYXJhbSAgQXJyYXkgICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICogQHJldHVybiBib29sZWFuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUudmFsaWRhdGVSZXF1aXJlZElmID0gZnVuY3Rpb24gKGZpZWxkLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldFZhbHVlKHBhcmFtZXRlcnNbMF0pID09PSBwYXJhbWV0ZXJzWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlUmVxdWlyZWQoZmllbGQsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFZhbGlkYXRlIHRoYXQgYSBmaWVsZCB3YXMgXCJhY2NlcHRlZFwiLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIFRoaXMgdmFsaWRhdGlvbiBydWxlIGltcGxpZXMgdGhlIGZpZWxkIGlzIFwicmVxdWlyZWRcIi5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIG1peGVkICAgIHZhbHVlXG4gICAgICAgICAgICAgKiBAcmV0dXJuIGJvb2xcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS52YWxpZGF0ZUFjY2VwdGVkID0gZnVuY3Rpb24gKGZpZWxkLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBhY2NlcHRhYmxlID0gWyd5ZXMnLCAnb24nLCAnMScsIDEsIHRydWUsICd0cnVlJ107XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gKHRoaXMudmFsaWRhdGVSZXF1aXJlZChmaWVsZCwgdmFsdWUpICYmIGFjY2VwdGFibGUuaW5kZXhPZih2YWx1ZSkgIT09IC0xKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVmFsaWRhdGUgdGhhdCBhbiBmaWVsZCBpcyBudW1lcmljLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgbWl4ZWQgICAgdmFsdWVcbiAgICAgICAgICAgICAqIEByZXR1cm4gYm9vbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnZhbGlkYXRlTnVtZXJpYyA9IGZ1bmN0aW9uIChmaWVsZCwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIWlzTmFOKHZhbHVlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVmFsaWRhdGUgdGhlIHNpemUgb2YgYW4gZmllbGQgaXMgYmV0d2VlbiBhIHNldCBvZiB2YWx1ZXMuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIG1peGVkICAgdmFsdWVcbiAgICAgICAgICAgICAqIEBwYXJhbSAgYXJyYXkgICBwYXJhbWV0ZXJzXG4gICAgICAgICAgICAgKiBAcmV0dXJuIGJvb2xcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS52YWxpZGF0ZUJldHdlZW4gPSBmdW5jdGlvbiAoZmllbGQsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1aXJlUGFyYW1ldGVyQ291bnQoMiwgcGFyYW1ldGVycywgJ2JldHdlZW4nKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IHRoaXMuZ2V0U2l6ZShmaWVsZCwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiBzaXplID49IHBhcmFtZXRlcnNbMF0gJiYgc2l6ZSA8PSBwYXJhbWV0ZXJzWzFdO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXF1aXJlIGEgY2VydGFpbiBudW1iZXIgb2YgcGFyYW1ldGVycyB0byBiZSBwcmVzZW50LlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgaW50ICAgICBjb3VudFxuICAgICAgICAgICAgICogQHBhcmFtICBhcnJheSAgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBydWxlXG4gICAgICAgICAgICAgKiBAcmV0dXJuXG4gICAgICAgICAgICAgKiBAdGhyb3dzIEVycm9yXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucmVxdWlyZVBhcmFtZXRlckNvdW50ID0gZnVuY3Rpb24gKGNvdW50LCBwYXJhbWV0ZXJzLCBydWxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmFtZXRlcnMubGVuZ3RoIDwgY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVmFsaWRhdGlvbiBydWxlIFwiICsgcnVsZSArIFwiIHJlcXVpcmVzIGF0IGxlYXN0IFwiICsgY291bnQgKyBcIiBwYXJhbWV0ZXJzLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEdldCB0aGUgc2l6ZSBvZiBhbiBmaWVsZC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgbWl4ZWQgICB2YWx1ZVxuICAgICAgICAgICAgICogQHJldHVybiBtaXhlZFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoZmllbGQsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGhhc051bWVyaWMgPSB0aGlzLmhhc1J1bGUoZmllbGQsIHRoaXMubnVtZXJpY1J1bGVzKTtcblxuICAgICAgICAgICAgICAgIC8vIFRoaXMgbWV0aG9kIHdpbGwgZGV0ZXJtaW5lIGlmIHRoZSBmaWVsZCBpcyBhIG51bWJlciwgc3RyaW5nLCBvciBmaWxlIGFuZFxuICAgICAgICAgICAgICAgIC8vIHJldHVybiB0aGUgcHJvcGVyIHNpemUgYWNjb3JkaW5nbHkuIElmIGl0IGlzIGEgbnVtYmVyLCB0aGVuIG51bWJlciBpdHNlbGZcbiAgICAgICAgICAgICAgICAvLyBpcyB0aGUgc2l6ZS4gSWYgaXQgaXMgYSBmaWxlLCB3ZSB0YWtlIGtpbG9ieXRlcywgYW5kIGZvciBhIHN0cmluZyB0aGVcbiAgICAgICAgICAgICAgICAvLyBlbnRpcmUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcgd2lsbCBiZSBjb25zaWRlcmVkIHRoZSBmaWVsZCBzaXplLlxuICAgICAgICAgICAgICAgIGlmICghaXNOYU4odmFsdWUpICYmIGhhc051bWVyaWMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVtmaWVsZF07XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUubGVuZ3RoID4gMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTdHJpbmdTaXplKHZhbHVlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogR2V0IHRoZSBzaXplIG9mIGEgc3RyaW5nLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICB2YWx1ZVxuICAgICAgICAgICAgICogQHJldHVybiBpbnRcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5nZXRTdHJpbmdTaXplID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoJycgKyB2YWx1ZSkudHJpbSgpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7IFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGdpdmVuIGZpZWxkIGhhcyBhIHJ1bGUgaW4gdGhlIGdpdmVuIHNldC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgICAgICAgICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmd8b2JqZWN0ICAgcnVsZXNcbiAgICAgICAgICAgICAqIEByZXR1cm4gYm9vbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmhhc1J1bGUgPSBmdW5jdGlvbiAoZmllbGQsIHJ1bGVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5nZXRSdWxlKGZpZWxkLCBydWxlcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogR2V0IGEgcnVsZSBhbmQgaXRzIHBhcmFtZXRlcnMgZm9yIGEgZ2l2ZW4gZmllbGQuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICAgICAgICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmd8b2JqZWN0ICBydWxlc1xuICAgICAgICAgICAgICogQHJldHVybiBvYmplY3R8dW5kZWZpbmVkXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuZ2V0UnVsZSA9IGZ1bmN0aW9uIChmaWVsZCwgcnVsZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucnVsZXNbZmllbGRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBydWxlIGluIHRoaXMucnVsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlZCA9IHRoaXMucGFyc2VSdWxlKHRoaXMucnVsZXNbcnVsZV0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChydWxlcy5pbmRleE9mKHBhcnNlZC5ydWxlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogR2V0IHRoZSBkaXNwbGF5YWJsZSBuYW1lIG9mIHRoZSBmaWVsZC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuZ2V0RmllbGQgPSBmdW5jdGlvbiAoZmllbGQpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgZGV2ZWxvcGVyIG1heSBkeW5hbWljYWxseSBzcGVjaWZ5IHRoZSBhcnJheSBvZiBjdXN0b20gZmllbGRzXG4gICAgICAgICAgICAgICAgLy8gb24gdGhpcyBWYWxpZGF0b3IgaW5zdGFuY2UuIElmIHRoZSBmaWVsZCBleGlzdHMgaW4gdGhpcyBhcnJheVxuICAgICAgICAgICAgICAgIC8vIGl0IHRha2VzIHByZWNlZGVuY2Ugb3ZlciBhbGwgb3RoZXIgd2F5cyB3ZSBjYW4gcHVsbCBmaWVsZHMuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VzdG9tRmllbGRzW2ZpZWxkXSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jdXN0b21GaWVsZHNbZmllbGRdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBrZXkgPSAnZmllbGRzLicgKyBmaWVsZDtcbiAgICAgICAgICAgICAgICAvLyBXZSBhbGxvdyBmb3IgdGhlIGRldmVsb3BlciB0byBzcGVjaWZ5IGxhbmd1YWdlIG1lc3NhZ2VzIGZvciBlYWNoIG9mIHRoZVxuICAgICAgICAgICAgICAgIC8vIGZpZWxkcyBhbGxvd2luZyBmb3IgbW9yZSBkaXNwbGF5YWJsZSBjb3VudGVycGFydHMgb2YgZWFjaCBvZlxuICAgICAgICAgICAgICAgIC8vIHRoZSBmaWVsZHMuIFRoaXMgcHJvdmlkZXMgdGhlIGFiaWxpdHkgZm9yIHNpbXBsZSBmb3JtYXRzLlxuXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBWYWxpZGF0aW9uVHJhbnNsYXRvci50cmFucyhrZXkpXG5cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZSAhPT0ga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIElmIG5vIGxhbmd1YWdlIG1lc3NhZ2UgaGFzIGJlZW4gc3BlY2lmaWVkIGZvciB0aGUgZmllbGQgYWxsIG9mIHRoZVxuICAgICAgICAgICAgICAgIC8vIHVuZGVyc2NvcmVzIGFyZSByZW1vdmVkIGZyb20gdGhlIGZpZWxkIG5hbWUgYW5kIHRoYXQgd2lsbCBiZVxuICAgICAgICAgICAgICAgIC8vIHVzZWQgYXMgZGVmYXVsdCB2ZXJzaW9ucyBvZiB0aGUgZmllbGQncyBkaXNwbGF5YWJsZSBuYW1lcy5cbiAgICAgICAgICAgICAgICByZXR1cm4gc25ha2VDYXNlKGZpZWxkKS5yZXBsYWNlKC9fL2csICcgJyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEdldCB0aGUgZGF0YSB0eXBlIG9mIHRoZSBnaXZlbiBmaWVsZC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuZ2V0RmllbGRUeXBlID0gZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzUnVsZShmaWVsZCwgdGhpcy5udW1lcmljUnVsZXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbnVtZXJpYyc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmhhc1J1bGUoZmllbGQsICdBcnJheScpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnYXJyYXknO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAnc3RyaW5nJztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVHJhbnNmb3JtIGFuIGFycmF5IG9mIGZpZWxkcyB0byB0aGVpciBkaXNwbGF5YWJsZSBmb3JtLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgYXJyYXkgIHZhbHVlc1xuICAgICAgICAgICAgICogQHJldHVybiBhcnJheVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmdldEF0dHJpYnV0ZUxpc3QgPSBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpZWxkcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggZmllbGQgaW4gdGhlIGxpc3Qgd2Ugd2lsbCBzaW1wbHkgZ2V0IGl0cyBkaXNwbGF5YWJsZSBmb3JtIGFzXG4gICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBjb252ZW5pZW50IHdoZW4gcmVwbGFjaW5nIGxpc3RzIG9mIHBhcmFtZXRlcnMgbGlrZSBzb21lIG9mIHRoZVxuICAgICAgICAgICAgICAgIC8vIHJlcGxhY2VtZW50IGZ1bmN0aW9ucyBkbyB3aGVuIGZvcm1hdHRpbmcgb3V0IHRoZSB2YWxpZGF0aW9uIG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2godGhpcy5nZXRGaWVsZCh2YWx1ZXNbaV0pKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkcztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogR2V0IHRoZSBkaXNwbGF5YWJsZSBuYW1lIG9mIHRoZSB2YWx1ZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgbWl4ZWQgICB2YWx1ZVxuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5nZXREaXNwbGF5YWJsZVZhbHVlID0gZnVuY3Rpb24gKGZpZWxkLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1c3RvbVZhbHVlc1tmaWVsZF1bdmFsdWVdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbVZhbHVlc1tmaWVsZF1bdmFsdWVdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBrZXkgPSAndmFsdWVzLicgKyBmaWVsZCArICcuJyArIHZhbHVlO1xuXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBWYWxpZGF0aW9uVHJhbnNsYXRvci50cmFucyhrZXkpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgIT09IGtleSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBwbGFjZS1ob2xkZXJzIGZvciB0aGUgYmV0d2VlbiBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICAgbWVzc2FnZVxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIGFycmF5ICAgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucmVwbGFjZUJldHdlZW4gPSBmdW5jdGlvbiAobWVzc2FnZSwgZmllbGQsIHJ1bGUsIHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZS5yZXBsYWNlKCc6bWluJywgcGFyYW1ldGVyc1swXSkucmVwbGFjZSgnOm1heCcsIHBhcmFtZXRlcnNbMV0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBwbGFjZS1ob2xkZXJzIGZvciB0aGUgZGlnaXRzIHJ1bGUuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgICBtZXNzYWdlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgIHJ1bGVcbiAgICAgICAgICAgICAqIEBwYXJhbSAgYXJyYXkgICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5yZXBsYWNlRGlnaXRzID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGZpZWxkLCBydWxlLCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2UucmVwbGFjZSgnOmRpZ2l0cycsIHBhcmFtZXRlcnNbMF0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBwbGFjZS1ob2xkZXJzIGZvciB0aGUgZGlnaXRzIChiZXR3ZWVuKSBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBtZXNzYWdlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIGFycmF5ICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5yZXBsYWNlRGlnaXRzQmV0d2VlbiA9IGZ1bmN0aW9uIChtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2VCZXR3ZWVuKG1lc3NhZ2UsIGZpZWxkLCBydWxlLCBwYXJhbWV0ZXJzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUmVwbGFjZSBhbGwgcGxhY2UtaG9sZGVycyBmb3IgdGhlIHNpemUgcnVsZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgbWVzc2FnZVxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgcnVsZVxuICAgICAgICAgICAgICogQHBhcmFtICBhcnJheSAgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucmVwbGFjZVNpemUgPSBmdW5jdGlvbiAobWVzc2FnZSwgZmllbGQsIHJ1bGUsIHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZS5yZXBsYWNlKCc6c2l6ZScsIHBhcmFtZXRlcnNbMF0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBwbGFjZS1ob2xkZXJzIGZvciB0aGUgbWluIHJ1bGUuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIG1lc3NhZ2VcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIHJ1bGVcbiAgICAgICAgICAgICAqIEBwYXJhbSAgYXJyYXkgICBwYXJhbWV0ZXJzXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHN0cmluZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnJlcGxhY2VNaW4gPSBmdW5jdGlvbiAobWVzc2FnZSwgZmllbGQsIHJ1bGUsIHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZS5yZXBsYWNlKCc6bWluJywgcGFyYW1ldGVyc1swXSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFJlcGxhY2UgYWxsIHBsYWNlLWhvbGRlcnMgZm9yIHRoZSBtYXggcnVsZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgbWVzc2FnZVxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgcnVsZVxuICAgICAgICAgICAgICogQHBhcmFtICBhcnJheSAgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucmVwbGFjZU1heCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoJzptYXgnLCBwYXJhbWV0ZXJzWzBdKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUmVwbGFjZSBhbGwgcGxhY2UtaG9sZGVycyBmb3IgdGhlIGluIHJ1bGUuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIG1lc3NhZ2VcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIHJ1bGVcbiAgICAgICAgICAgICAqIEBwYXJhbSAgYXJyYXkgICBwYXJhbWV0ZXJzXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHN0cmluZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnJlcGxhY2VJbiA9IGZ1bmN0aW9uIChtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFyYW1ldGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzW2ldID0gdGhpcy5nZXREaXNwbGF5YWJsZVZhbHVlKGZpZWxkLCBwYXJhbWV0ZXJzW2ldKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2UucmVwbGFjZSgnOnZhbHVlcycsIHBhcmFtZXRlcnMuam9pbignLCAnKSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFJlcGxhY2UgYWxsIHBsYWNlLWhvbGRlcnMgZm9yIHRoZSBub3RfaW4gcnVsZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgbWVzc2FnZVxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgcnVsZVxuICAgICAgICAgICAgICogQHBhcmFtICBhcnJheSAgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucmVwbGFjZU5vdEluID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGZpZWxkLCBydWxlLCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVwbGFjZUluKG1lc3NhZ2UsIGZpZWxkLCBydWxlLCBwYXJhbWV0ZXJzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUmVwbGFjZSBhbGwgcGxhY2UtaG9sZGVycyBmb3IgdGhlIG1pbWVzIHJ1bGUuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIG1lc3NhZ2VcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIHJ1bGVcbiAgICAgICAgICAgICAqIEBwYXJhbSAgYXJyYXkgICBwYXJhbWV0ZXJzXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHN0cmluZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnJlcGxhY2VNaW1lcyA9IGZ1bmN0aW9uIChtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoJzp2YWx1ZXMnLCBwYXJhbWV0ZXJzLmpvaW4oJywgJykpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBwbGFjZS1ob2xkZXJzIGZvciB0aGUgcmVxdWlyZWRfd2l0aCBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBtZXNzYWdlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIGFycmF5ICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5yZXBsYWNlUmVxdWlyZWRXaXRoID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGZpZWxkLCBydWxlLCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1ldGVycyA9IHRoaXMuZ2V0RmllbGRMaXN0KHBhcmFtZXRlcnMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoJzp2YWx1ZXMnLCBwYXJhbWV0ZXJzLmpvaW4oJyAvICcpKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUmVwbGFjZSBhbGwgcGxhY2UtaG9sZGVycyBmb3IgdGhlIHJlcXVpcmVkX3dpdGhvdXQgcnVsZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgbWVzc2FnZVxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgcnVsZVxuICAgICAgICAgICAgICogQHBhcmFtICBhcnJheSAgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucmVwbGFjZVJlcXVpcmVkV2l0aG91dCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2VSZXF1aXJlZFdpdGgobWVzc2FnZSwgZmllbGQsIHJ1bGUsIHBhcmFtZXRlcnMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBwbGFjZS1ob2xkZXJzIGZvciB0aGUgcmVxdWlyZWRfd2l0aG91dF9hbGwgcnVsZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgbWVzc2FnZVxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgcnVsZVxuICAgICAgICAgICAgICogQHBhcmFtICBhcnJheSAgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucmVwbGFjZVJlcXVpcmVkV2l0aG91dEFsbCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2VSZXF1aXJlZFdpdGgobWVzc2FnZSwgZmllbGQsIHJ1bGUsIHBhcmFtZXRlcnMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBwbGFjZS1ob2xkZXJzIGZvciB0aGUgcmVxdWlyZWRfaWYgcnVsZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgbWVzc2FnZVxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIGZpZWxkXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgcnVsZVxuICAgICAgICAgICAgICogQHBhcmFtICBhcnJheSAgIHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAqIEByZXR1cm4gc3RyaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucmVwbGFjZVJlcXVpcmVkSWYgPSBmdW5jdGlvbiAobWVzc2FnZSwgZmllbGQsIHJ1bGUsIHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzWzFdID0gdGhpcy5nZXREaXNwbGF5YWJsZVZhbHVlKHBhcmFtZXRlcnNbMF0sIGFycmF5X2dldCh0aGlzLmRhdGEsIHBhcmFtZXRlcnNbMF0pKTtcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzWzBdID0gdGhpcy5nZXRGaWVsZChwYXJhbWV0ZXJzWzBdKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoJzpvdGhlcicsIHBhcmFtZXRlcnNbMF0pLnJlcGxhY2UoJzp2YWx1ZScsIHBhcmFtZXRlcnNbMV0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBwbGFjZS1ob2xkZXJzIGZvciB0aGUgc2FtZSBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBtZXNzYWdlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIGFycmF5ICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5yZXBsYWNlU2FtZSA9IGZ1bmN0aW9uIChtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoJzpvdGhlcicsIHRoaXMuZ2V0RmllbGQocGFyYW1ldGVyc1swXSkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBSZXBsYWNlIGFsbCBwbGFjZS1ob2xkZXJzIGZvciB0aGUgZGlmZmVyZW50IHJ1bGUuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIG1lc3NhZ2VcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBmaWVsZFxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIHJ1bGVcbiAgICAgICAgICAgICAqIEBwYXJhbSAgYXJyYXkgICBwYXJhbWV0ZXJzXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHN0cmluZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnJlcGxhY2VEaWZmZXJlbnQgPSBmdW5jdGlvbiAobWVzc2FnZSwgZmllbGQsIHJ1bGUsIHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXBsYWNlU2FtZShtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFJlcGxhY2UgYWxsIHBsYWNlLWhvbGRlcnMgZm9yIHRoZSBkYXRlX2Zvcm1hdCBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBtZXNzYWdlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIGFycmF5ICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5yZXBsYWNlRGF0ZUZvcm1hdCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBmaWVsZCwgcnVsZSwgcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoJzpmb3JtYXQnLCBwYXJhbWV0ZXJzWzBdKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUmVwbGFjZSBhbGwgcGxhY2UtaG9sZGVycyBmb3IgdGhlIGJlZm9yZSBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBtZXNzYWdlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIGFycmF5ICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5yZXBsYWNlQmVmb3JlID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGZpZWxkLCBydWxlLCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFEYXRlLnBhcnNlKHBhcmFtZXRlcnNbMF0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoJzpkYXRlJywgdGhpcy5nZXRGaWVsZChwYXJhbWV0ZXJzWzBdKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoJzpkYXRlJywgcGFyYW1ldGVyc1swXSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFJlcGxhY2UgYWxsIHBsYWNlLWhvbGRlcnMgZm9yIHRoZSBhZnRlciBydWxlLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBtZXNzYWdlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgZmllbGRcbiAgICAgICAgICAgICAqIEBwYXJhbSAgc3RyaW5nICBydWxlXG4gICAgICAgICAgICAgKiBAcGFyYW0gIGFycmF5ICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5yZXBsYWNlQWZ0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgZmllbGQsIHJ1bGUsIHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXBsYWNlQmVmb3JlKG1lc3NhZ2UsIGZpZWxkLCBydWxlLCBwYXJhbWV0ZXJzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogSGVscGVyIGZ1bmN0aW9uc1xuICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRnVuY3Rpb24gdG8gY29udmVydCBlYWNoIHdvcmRgcyBmaXJzdCBsZXR0ZXIgdG8gdXBwZXIgY2FzZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgc3RyXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHN0cmluZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmdW5jdGlvbiB1Y3dvcmRzKHN0cikge1xuICAgICAgICAgICAgICAgIC8vICBkaXNjdXNzIGF0OiBodHRwOi8vcGhwanMub3JnL2Z1bmN0aW9ucy91Y3dvcmRzL1xuICAgICAgICAgICAgICAgIC8vIG9yaWdpbmFsIGJ5OiBKb25hcyBSYW9uaSBTb2FyZXMgU2lsdmEgKGh0dHA6Ly93d3cuanNmcm9taGVsbC5jb20pXG4gICAgICAgICAgICAgICAgLy8gaW1wcm92ZWQgYnk6IFdhbGRvIE1hbHF1aSBTaWx2YSAoaHR0cDovL3dhbGRvLm1hbHF1aS5pbmZvKVxuICAgICAgICAgICAgICAgIC8vIGltcHJvdmVkIGJ5OiBSb2JpblxuICAgICAgICAgICAgICAgIC8vIGltcHJvdmVkIGJ5OiBLZXZpbiB2YW4gWm9ubmV2ZWxkIChodHRwOi8va2V2aW4udmFuem9ubmV2ZWxkLm5ldClcbiAgICAgICAgICAgICAgICAvLyBidWdmaXhlZCBieTogT25ubyBNYXJzbWFuXG4gICAgICAgICAgICAgICAgLy8gICAgaW5wdXQgYnk6IEphbWVzIChodHRwOi8vd3d3LmphbWVzLWJlbGwuY28udWsvKVxuICAgICAgICAgICAgICAgIC8vICAgZXhhbXBsZSAxOiB1Y3dvcmRzKCdrZXZpbiB2YW4gIHpvbm5ldmVsZCcpO1xuICAgICAgICAgICAgICAgIC8vICAgcmV0dXJucyAxOiAnS2V2aW4gVmFuICBab25uZXZlbGQnXG4gICAgICAgICAgICAgICAgLy8gICBleGFtcGxlIDI6IHVjd29yZHMoJ0hFTExPIFdPUkxEJyk7XG4gICAgICAgICAgICAgICAgLy8gICByZXR1cm5zIDI6ICdIRUxMTyBXT1JMRCdcblxuICAgICAgICAgICAgICAgIHJldHVybiAoc3RyICsgJycpLnJlcGxhY2UoL14oW2EtelxcdTAwRTAtXFx1MDBGQ10pfFxccysoW2EtelxcdTAwRTAtXFx1MDBGQ10pL2csIGZ1bmN0aW9uICgkMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJDEudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRnVuY3Rpb24gdG8gY29udmVydCB0ZXh0IGludG8gc3R1ZGx5IGNhc2UuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtICBzdHJpbmcgIHN0clxuICAgICAgICAgICAgICogQHJldHVybiBzdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZnVuY3Rpb24gc3R1ZGx5Q2FzZShzdHIpIHtcbiAgICAgICAgICAgICAgICBzdHIgPSB1Y3dvcmRzKChzdHIgKyAnJykucmVwbGFjZSgvWy1fXS9nLCAnICcpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1tcXHNdL2csICcnKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRnVuY3Rpb24gdG8gY29udmVydCB0ZXh0IGludG8gc25ha2UgY2FzZS5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHN0cmluZyAgc3RyXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHN0cmluZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmdW5jdGlvbiBzbmFrZUNhc2Uoc3RyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChzdHIgKyAnJykucmVwbGFjZSgvKC4pKFtBLVpdKS9nLCAnJDFfJDInKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gcmVwbGFjZShzdHIsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoLzooW0Etel0qKS9nLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSBkYXRhW2JdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiByID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgciA9PT0gJ251bWJlcicgPyByIDogYTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gVmFsaWRhdG9yO1xuICAgICAgICB9XG4gICAgXSk7IixudWxsXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=